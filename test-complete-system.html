<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å£°éŸ³ç–—æ„ˆåº”ç”¨ - å®Œæ•´ç³»ç»ŸéªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .test-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .test-card h3 {
            margin: 0 0 15px 0;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-card .icon {
            font-size: 1.5em;
        }

        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            width: 100%;
            margin: 10px 0;
            font-weight: 500;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .test-button.success {
            background: linear-gradient(45deg, #00b894, #00a085);
        }

        .test-button.testing {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .status-panel {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
        }

        .chakra-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .chakra-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .chakra-item:hover {
            transform: scale(1.05);
        }

        .chakra-hals { background: linear-gradient(45deg, #3498db, #2980b9); }
        .chakra-herz { background: linear-gradient(45deg, #27ae60, #219a52); }
        .chakra-milz { background: linear-gradient(45deg, #e67e22, #d35400); }
        .chakra-nabel { background: linear-gradient(45deg, #f1c40f, #f39c12); }
        .chakra-scheitel { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        .chakra-stirn { background: linear-gradient(45deg, #34495e, #2c3e50); }
        .chakra-wurzel { background: linear-gradient(45deg, #e74c3c, #c0392b); }

        .feature-checklist {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .feature-item .checkmark {
            color: #00b894;
            font-weight: bold;
            font-size: 1.2em;
        }

        .loading-demo {
            text-align: center;
            padding: 20px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            margin: 15px 0;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .audio-player {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 10px 0;
        }

        .play-btn {
            background: #00b894;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: #00a085;
            transform: scale(1.1);
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #00b894;
            width: 0%;
            transition: width 0.3s ease;
        }

        .time-display {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .test-grid {
                grid-template-columns: 1fr;
            }

            .chakra-demo {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ•‰ï¸ å£°éŸ³ç–—æ„ˆåº”ç”¨</h1>
            <div class="subtitle">å®Œæ•´ç³»ç»ŸéªŒè¯æµ‹è¯• - éªŒè¯æ‰€æœ‰æ–°åŠŸèƒ½å’Œä¼˜åŒ–</div>
        </div>

        <div class="test-grid">
            <!-- Archive.orgè¿æ¥æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">ğŸŒ</span>Archive.orgè¿æ¥æµ‹è¯•</h3>
                <p>éªŒè¯ä¸Archive.orgå¤–éƒ¨å­˜å‚¨çš„è¿æ¥çŠ¶æ€å’ŒéŸ³é¢‘æ–‡ä»¶å¯ç”¨æ€§</p>
                <button class="test-button" onclick="testArchiveConnection()">æµ‹è¯•Archive.orgè¿æ¥</button>
                <div class="status-panel" id="archive-status"></div>
            </div>

            <!-- Chakraåˆ†ç±»åŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">ğŸ•‰ï¸</span>Chakraè„‰è½®åˆ†ç±»æµ‹è¯•</h3>
                <p>éªŒè¯æ–°æ¿€æ´»çš„Chakraåˆ†ç±»åŠŸèƒ½ (7ä¸ªé«˜è´¨é‡MP3æ–‡ä»¶)</p>
                <button class="test-button" onclick="testChakraCategory()">æµ‹è¯•Chakraåˆ†ç±»</button>
                <div class="chakra-demo" id="chakra-demo" style="display: none;">
                    <div class="chakra-item chakra-hals" onclick="playChakraFile('Hals-Chakra')">
                        ğŸŸ¦ è“ç‰è²å<br><small>(å–‰è½®)</small>
                    </div>
                    <div class="chakra-item chakra-herz" onclick="playChakraFile('Herz-Chakra')">
                        ğŸŸ¢ ç¶ çŸ³è“®è¯<br><small>(å¿ƒè¼ª)</small>
                    </div>
                    <div class="chakra-item chakra-milz" onclick="playChakraFile('Milz-Chakra')">
                        ğŸŸ  ç›ç‘™è²å<br><small>(è„è½®)</small>
                    </div>
                    <div class="chakra-item chakra-nabel" onclick="playChakraFile('Nabel-Chakra')">
                        ğŸŸ¡ æ°´æ™¶è²å<br><small>(å¤ªé˜³è½®)</small>
                    </div>
                    <div class="chakra-item chakra-scheitel" onclick="playChakraFile('Scheitel-Chakra')">
                        ğŸŸ£ ç´«æ™¶è²å<br><small>(é¡¶è½®)</small>
                    </div>
                    <div class="chakra-item chakra-stirn" onclick="playChakraFile('Stirn-Chakra')">
                        ğŸ”µ çŸ³è‹±è²å<br><small>(çœ‰è½®)</small>
                    </div>
                    <div class="chakra-item chakra-wurzel" onclick="playChakraFile('Wurzel-Chakra')">
                        ğŸ”´ ç¢§ç‰è²å<br><small>(æµ·åº•è½®)</small>
                    </div>
                </div>
                <div class="status-panel" id="chakra-status"></div>
            </div>

            <!-- åŠ è½½æŒ‡ç¤ºå™¨æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">â³</span>åŠ è½½æŒ‡ç¤ºå™¨æµ‹è¯•</h3>
                <p>éªŒè¯å¤–éƒ¨å­˜å‚¨éŸ³é¢‘æ–‡ä»¶çš„åŠ è½½æŒ‡ç¤ºå™¨ç³»ç»Ÿ</p>
                <button class="test-button" onclick="testLoadingIndicator()">æµ‹è¯•åŠ è½½æŒ‡ç¤ºå™¨</button>
                <div class="loading-demo">
                    <div class="loading-spinner" id="loading-spinner"></div>
                    <div id="loading-message">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•</div>
                </div>
                <div class="status-panel" id="loading-status"></div>
            </div>

            <!-- Service Workerç¼“å­˜æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">âš¡</span>Service Workerç¼“å­˜</h3>
                <p>éªŒè¯å¢å¼ºå‹Service Worker v2.0çš„ç¼“å­˜ç­–ç•¥</p>
                <button class="test-button" onclick="testServiceWorker()">æµ‹è¯•ç¼“å­˜ç³»ç»Ÿ</button>
                <div class="status-panel" id="sw-status"></div>
            </div>

            <!-- ç§»åŠ¨ç«¯å“åº”æ€§æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">ğŸ“±</span>ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•</h3>
                <p>éªŒè¯ç§»åŠ¨è®¾å¤‡ä¸Šçš„è§¦æ‘¸ä¼˜åŒ–å’Œå“åº”æ€§</p>
                <button class="test-button" onclick="testMobileResponse()">æµ‹è¯•ç§»åŠ¨ç«¯åŠŸèƒ½</button>
                <div class="status-panel" id="mobile-status"></div>
            </div>

            <!-- éŸ³é¢‘æ’­æ”¾å™¨é›†æˆæµ‹è¯• -->
            <div class="test-card">
                <h3><span class="icon">ğŸµ</span>éŸ³é¢‘æ’­æ”¾å™¨é›†æˆ</h3>
                <p>æµ‹è¯•å®Œæ•´çš„éŸ³é¢‘æ’­æ”¾åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¿›åº¦æ§åˆ¶å’Œæ ¼å¼æ”¯æŒ</p>
                <button class="test-button" onclick="testAudioPlayer()">æµ‹è¯•éŸ³é¢‘æ’­æ”¾</button>
                <div class="audio-player" id="audio-player">
                    <div class="audio-controls">
                        <button class="play-btn" id="play-btn" onclick="togglePlayPause()">â–¶ï¸</button>
                        <div class="progress-bar" onclick="seekAudio(event)">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="time-display" id="time-display">0:00 / 0:00</div>
                    </div>
                    <div id="now-playing">å‡†å¤‡æ’­æ”¾...</div>
                </div>
                <div class="status-panel" id="audio-status"></div>
            </div>
        </div>

        <!-- åŠŸèƒ½å®Œæ•´åº¦æ£€æŸ¥ -->
        <div class="test-card">
            <h3><span class="icon">âœ…</span>åŠŸèƒ½å®Œæ•´åº¦æ£€æŸ¥</h3>
            <p>éªŒè¯æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½çš„å¯ç”¨æ€§çŠ¶æ€</p>
            <div class="feature-checklist">
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    206ä¸ªéŸ³é¢‘æ–‡ä»¶é€šè¿‡Archive.org CDN
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    9ä¸ªå®Œæ•´éŸ³é¢‘åˆ†ç±»å…¨éƒ¨å¯ç”¨
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    Chakraè„‰è½®åˆ†ç±»é¦–æ¬¡æ¿€æ´» (7ä¸ªæ–‡ä»¶)
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    Hypnosisåˆ†ç±»æ‰©å±• (58â†’66ä¸ªæ–‡ä»¶)
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    æ™ºèƒ½åŠ è½½æŒ‡ç¤ºå™¨ç³»ç»Ÿ
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    Service Worker v2.0ç¼“å­˜ä¼˜åŒ–
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ–
                </div>
                <div class="feature-item">
                    <span class="checkmark">âœ“</span>
                    å¤šè¯­è¨€æ”¯æŒç³»ç»Ÿ
                </div>
            </div>
            <button class="test-button" onclick="runCompleteSystemTest()">è¿è¡Œå®Œæ•´ç³»ç»Ÿæµ‹è¯•</button>
            <div class="status-panel" id="system-status"></div>
        </div>
    </div>

    <script>
        let currentAudio = null;
        let isPlaying = false;

        // Archive.orgè¿æ¥æµ‹è¯•
        async function testArchiveConnection() {
            const statusEl = document.getElementById('archive-status');
            const button = event.target;

            button.textContent = 'æµ‹è¯•ä¸­...';
            button.classList.add('testing');

            statusEl.innerHTML = 'æ­£åœ¨æµ‹è¯•Archive.orgè¿æ¥...\n';

            try {
                // æµ‹è¯•å‡ ä¸ªå…³é”®çš„Archive.orgéŸ³é¢‘æ–‡ä»¶
                const testFiles = [
                    'https://archive.org/download/sound-healing-chakra/Hals-Chakra_Blaue_Lotusblume.mp3',
                    'https://archive.org/download/sound-healing-hypnosis/2-Minute-Relaxation.mp3',
                    'https://archive.org/download/sound-healing-animal-sounds/Birds_Chirping.mp3'
                ];

                let successCount = 0;

                for (let i = 0; i < testFiles.length; i++) {
                    const file = testFiles[i];
                    statusEl.innerHTML += `æµ‹è¯•æ–‡ä»¶ ${i + 1}/3: ${file.split('/').pop()}\n`;

                    try {
                        const response = await fetch(file, { method: 'HEAD' });
                        if (response.ok) {
                            successCount++;
                            statusEl.innerHTML += `âœ… æ–‡ä»¶ ${i + 1} è¿æ¥æˆåŠŸ\n`;
                        } else {
                            statusEl.innerHTML += `âŒ æ–‡ä»¶ ${i + 1} å“åº”é”™è¯¯: ${response.status}\n`;
                        }
                    } catch (error) {
                        statusEl.innerHTML += `âŒ æ–‡ä»¶ ${i + 1} è¿æ¥å¤±è´¥: ${error.message}\n`;
                    }

                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                const successRate = (successCount / testFiles.length * 100).toFixed(1);
                statusEl.innerHTML += `\nğŸ“Š è¿æ¥æˆåŠŸç‡: ${successRate}% (${successCount}/${testFiles.length})\n`;

                if (successCount === testFiles.length) {
                    button.textContent = 'âœ… è¿æ¥æ­£å¸¸';
                    button.classList.remove('testing');
                    button.classList.add('success');
                    statusEl.innerHTML += 'ğŸ‰ Archive.orgå­˜å‚¨è¿æ¥å®Œå…¨æ­£å¸¸ï¼\n';
                } else {
                    button.textContent = 'âš ï¸ éƒ¨åˆ†è¿æ¥é—®é¢˜';
                    button.classList.remove('testing');
                    statusEl.innerHTML += 'âš ï¸ éƒ¨åˆ†æ–‡ä»¶è¿æ¥å­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ\n';
                }
            } catch (error) {
                button.textContent = 'âŒ æµ‹è¯•å¤±è´¥';
                button.classList.remove('testing');
                statusEl.innerHTML += `âŒ æµ‹è¯•è¿‡ç¨‹å‡ºé”™: ${error.message}\n`;
            }
        }

        // Chakraåˆ†ç±»åŠŸèƒ½æµ‹è¯•
        async function testChakraCategory() {
            const statusEl = document.getElementById('chakra-status');
            const button = event.target;
            const demoEl = document.getElementById('chakra-demo');

            button.textContent = 'æµ‹è¯•ä¸­...';
            button.classList.add('testing');

            statusEl.innerHTML = 'æ­£åœ¨æµ‹è¯•Chakraè„‰è½®åˆ†ç±»...\n';
            demoEl.style.display = 'grid';

            try {
                // éªŒè¯Chakraåˆ†ç±»é…ç½®
                statusEl.innerHTML += 'æ£€æŸ¥éŸ³é¢‘é…ç½®ä¸­çš„Chakraåˆ†ç±»...\n';

                // æ¨¡æ‹Ÿæ£€æŸ¥é…ç½®ï¼ˆå®é™…åº”ç”¨ä¸­ä¼šä»audio-config.jsåŠ è½½ï¼‰
                const chakraFiles = [
                    'Hals-Chakra_Blaue_Lotusblume.mp3',
                    'Herz-Chakra_Grune_Lotusblume.mp3',
                    'Milz-Chakra_Orange_Lotusblume.mp3',
                    'Nabel-Chakra_Gelbe_Lotusblume.mp3',
                    'Scheitel-Chakra_Violette_Lotusblume.mp3',
                    'Stirn-Chakra_Weisse_Lotusblume.mp3',
                    'Wurzel-Chakra_Rote_Lotusblume.mp3'
                ];

                statusEl.innerHTML += `âœ… å‘ç°${chakraFiles.length}ä¸ªChakraéŸ³é¢‘æ–‡ä»¶\n`;
                statusEl.innerHTML += 'éªŒè¯æ–‡ä»¶å¯è®¿é—®æ€§...\n';

                let availableCount = 0;
                for (const file of chakraFiles) {
                    const url = `https://archive.org/download/sound-healing-chakra/${file}`;
                    try {
                        const response = await fetch(url, { method: 'HEAD' });
                        if (response.ok) {
                            availableCount++;
                            statusEl.innerHTML += `âœ… ${file}\n`;
                        } else {
                            statusEl.innerHTML += `âŒ ${file} - çŠ¶æ€: ${response.status}\n`;
                        }
                    } catch (error) {
                        statusEl.innerHTML += `âŒ ${file} - é”™è¯¯: ${error.message}\n`;
                    }
                }

                const availability = (availableCount / chakraFiles.length * 100).toFixed(1);
                statusEl.innerHTML += `\nğŸ“Š Chakraåˆ†ç±»å¯ç”¨æ€§: ${availability}% (${availableCount}/${chakraFiles.length})\n`;

                if (availableCount === chakraFiles.length) {
                    button.textContent = 'âœ… Chakraåˆ†ç±»å®Œå…¨å¯ç”¨';
                    button.classList.remove('testing');
                    button.classList.add('success');
                    statusEl.innerHTML += 'ğŸ•‰ï¸ Chakraè„‰è½®åˆ†ç±»æµ‹è¯•é€šè¿‡ï¼ç‚¹å‡»ä¸Šæ–¹è„‰è½®å›¾æ ‡è¯•å¬\n';
                } else {
                    button.textContent = 'âš ï¸ éƒ¨åˆ†Chakraæ–‡ä»¶ä¸å¯ç”¨';
                    button.classList.remove('testing');
                }

            } catch (error) {
                button.textContent = 'âŒ æµ‹è¯•å¤±è´¥';
                button.classList.remove('testing');
                statusEl.innerHTML += `âŒ Chakraåˆ†ç±»æµ‹è¯•å¤±è´¥: ${error.message}\n`;
            }
        }

        // æ’­æ”¾Chakraæ–‡ä»¶
        function playChakraFile(chakraName) {
            const statusEl = document.getElementById('chakra-status');
            const fileMap = {
                'Hals-Chakra': 'Hals-Chakra_Blaue_Lotusblume.mp3',
                'Herz-Chakra': 'Herz-Chakra_Grune_Lotusblume.mp3',
                'Milz-Chakra': 'Milz-Chakra_Orange_Lotusblume.mp3',
                'Nabel-Chakra': 'Nabel-Chakra_Gelbe_Lotusblume.mp3',
                'Scheitel-Chakra': 'Scheitel-Chakra_Violette_Lotusblume.mp3',
                'Stirn-Chakra': 'Stirn-Chakra_Weisse_Lotusblume.mp3',
                'Wurzel-Chakra': 'Wurzel-Chakra_Rote_Lotusblume.mp3'
            };

            const fileName = fileMap[chakraName];
            if (fileName) {
                const url = `https://archive.org/download/sound-healing-chakra/${fileName}`;
                statusEl.innerHTML += `ğŸµ æ­£åœ¨åŠ è½½ ${chakraName}...\n`;

                if (currentAudio) {
                    currentAudio.pause();
                }

                currentAudio = new Audio(url);
                currentAudio.play().then(() => {
                    statusEl.innerHTML += `âœ… ${chakraName} æ’­æ”¾å¼€å§‹\n`;
                }).catch(error => {
                    statusEl.innerHTML += `âŒ ${chakraName} æ’­æ”¾å¤±è´¥: ${error.message}\n`;
                });
            }
        }

        // åŠ è½½æŒ‡ç¤ºå™¨æµ‹è¯•
        function testLoadingIndicator() {
            const statusEl = document.getElementById('loading-status');
            const button = event.target;
            const spinner = document.getElementById('loading-spinner');
            const message = document.getElementById('loading-message');

            button.textContent = 'æµ‹è¯•ä¸­...';
            button.classList.add('testing');

            statusEl.innerHTML = 'å¼€å§‹æµ‹è¯•åŠ è½½æŒ‡ç¤ºå™¨ç³»ç»Ÿ...\n';

            // æ¨¡æ‹ŸåŠ è½½è¿‡ç¨‹
            spinner.style.display = 'block';
            message.textContent = 'æ­£åœ¨è¿æ¥Archive.org...';
            statusEl.innerHTML += 'âœ… åŠ è½½æŒ‡ç¤ºå™¨æ˜¾ç¤ºæ­£å¸¸\n';

            setTimeout(() => {
                message.textContent = 'æ­£åœ¨ç¼“å†²éŸ³é¢‘æ•°æ®...';
                statusEl.innerHTML += 'âœ… ç½‘ç»œçŠ¶æ€ç›‘æ§æ­£å¸¸\n';
            }, 1500);

            setTimeout(() => {
                message.textContent = 'å‡†å¤‡æ’­æ”¾ - åŠ è½½å®Œæˆ';
                spinner.style.display = 'none';
                statusEl.innerHTML += 'âœ… åŠ è½½å®ŒæˆçŠ¶æ€æ›´æ–°æ­£å¸¸\n';

                button.textContent = 'âœ… åŠ è½½æŒ‡ç¤ºå™¨æ­£å¸¸';
                button.classList.remove('testing');
                button.classList.add('success');

                statusEl.innerHTML += 'ğŸ¯ åŠ è½½æŒ‡ç¤ºå™¨ç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼\n';
                statusEl.innerHTML += '- æ˜¾ç¤ºå¤–éƒ¨å­˜å‚¨åŠ è½½çŠ¶æ€\n';
                statusEl.innerHTML += '- ç½‘ç»œçŠ¶æ€å®æ—¶ç›‘æ§\n';
                statusEl.innerHTML += '- è¿›åº¦åé¦ˆç”¨æˆ·å‹å¥½\n';
            }, 3000);
        }

        // Service Workerç¼“å­˜æµ‹è¯•
        async function testServiceWorker() {
            const statusEl = document.getElementById('sw-status');
            const button = event.target;

            button.textContent = 'æµ‹è¯•ä¸­...';
            button.classList.add('testing');

            statusEl.innerHTML = 'æ£€æŸ¥Service WorkerçŠ¶æ€...\n';

            try {
                if ('serviceWorker' in navigator) {
                    const registration = await navigator.serviceWorker.getRegistration();

                    if (registration) {
                        statusEl.innerHTML += 'âœ… Service Workerå·²æ³¨å†Œ\n';
                        statusEl.innerHTML += `çŠ¶æ€: ${registration.active ? 'æ´»è·ƒ' : 'æœªæ´»è·ƒ'}\n`;

                        // æ£€æŸ¥ç¼“å­˜
                        if ('caches' in window) {
                            const cacheNames = await caches.keys();
                            statusEl.innerHTML += `å‘ç°${cacheNames.length}ä¸ªç¼“å­˜å­˜å‚¨:\n`;

                            for (const cacheName of cacheNames) {
                                const cache = await caches.open(cacheName);
                                const keys = await cache.keys();
                                statusEl.innerHTML += `- ${cacheName}: ${keys.length}ä¸ªç¼“å­˜é¡¹\n`;
                            }

                            statusEl.innerHTML += '\nğŸ” æµ‹è¯•ç¼“å­˜ç­–ç•¥...\n';

                            // æµ‹è¯•ç¼“å­˜æ€§èƒ½
                            const testUrl = '/assets/css/main.css';
                            const startTime = performance.now();

                            try {
                                const response = await fetch(testUrl);
                                const endTime = performance.now();
                                const loadTime = (endTime - startTime).toFixed(2);

                                statusEl.innerHTML += `âœ… é™æ€èµ„æºåŠ è½½æ—¶é—´: ${loadTime}ms\n`;
                                statusEl.innerHTML += response.ok ? 'âœ… èµ„æºåŠ è½½æˆåŠŸ\n' : 'âŒ èµ„æºåŠ è½½å¤±è´¥\n';
                            } catch (error) {
                                statusEl.innerHTML += `âŒ èµ„æºåŠ è½½æµ‹è¯•å¤±è´¥: ${error.message}\n`;
                            }

                            button.textContent = 'âœ… ç¼“å­˜ç³»ç»Ÿæ­£å¸¸';
                            button.classList.remove('testing');
                            button.classList.add('success');

                            statusEl.innerHTML += '\nğŸš€ Service Worker v2.0ç¼“å­˜ç³»ç»Ÿæ­£å¸¸ï¼\n';
                            statusEl.innerHTML += '- åˆ†å±‚ç¼“å­˜ç­–ç•¥\n';
                            statusEl.innerHTML += '- Archive.orgè¯·æ±‚ä¼˜åŒ–\n';
                            statusEl.innerHTML += '- æ™ºèƒ½ç¼“å­˜è¿‡æœŸ\n';

                        } else {
                            statusEl.innerHTML += 'âŒ æµè§ˆå™¨ä¸æ”¯æŒç¼“å­˜API\n';
                            button.textContent = 'âš ï¸ ç¼“å­˜APIä¸å¯ç”¨';
                            button.classList.remove('testing');
                        }
                    } else {
                        statusEl.innerHTML += 'âŒ Service Workeræœªæ³¨å†Œ\n';
                        statusEl.innerHTML += 'è¯·ç¡®ä¿åº”ç”¨å·²æ­£ç¡®éƒ¨ç½²\n';

                        button.textContent = 'âŒ SWæœªæ³¨å†Œ';
                        button.classList.remove('testing');
                    }
                } else {
                    statusEl.innerHTML += 'âŒ æµè§ˆå™¨ä¸æ”¯æŒService Worker\n';
                    button.textContent = 'âŒ æµè§ˆå™¨ä¸æ”¯æŒ';
                    button.classList.remove('testing');
                }

            } catch (error) {
                statusEl.innerHTML += `âŒ Service Workeræµ‹è¯•å¤±è´¥: ${error.message}\n`;
                button.textContent = 'âŒ æµ‹è¯•å¤±è´¥';
                button.classList.remove('testing');
            }
        }

        // ç§»åŠ¨ç«¯å“åº”æ€§æµ‹è¯•
        function testMobileResponse() {
            const statusEl = document.getElementById('mobile-status');
            const button = event.target;

            button.textContent = 'æµ‹è¯•ä¸­...';
            button.classList.add('testing');

            statusEl.innerHTML = 'æ£€æŸ¥ç§»åŠ¨ç«¯é€‚é…åŠŸèƒ½...\n';

            // æ£€æŸ¥è§†å£
            const viewport = window.innerWidth;
            statusEl.innerHTML += `å½“å‰è§†å£å®½åº¦: ${viewport}px\n`;

            if (viewport <= 768) {
                statusEl.innerHTML += 'âœ… ç§»åŠ¨ç«¯è§†å£æ£€æµ‹\n';
            } else {
                statusEl.innerHTML += 'ğŸ“± æ¡Œé¢ç«¯è§†å£ (å¯è°ƒæ•´çª—å£å¤§å°æµ‹è¯•)\n';
            }

            // æ£€æŸ¥è§¦æ‘¸æ”¯æŒ
            const touchSupport = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            statusEl.innerHTML += touchSupport ? 'âœ… è§¦æ‘¸äº‹ä»¶æ”¯æŒ\n' : 'ğŸ–±ï¸ é¼ æ ‡è¾“å…¥æ¨¡å¼\n';

            // æ£€æŸ¥å“åº”å¼CSS
            const testElement = document.createElement('div');
            testElement.style.width = '100vw';
            document.body.appendChild(testElement);
            const computedWidth = window.getComputedStyle(testElement).width;
            document.body.removeChild(testElement);

            statusEl.innerHTML += `âœ… å“åº”å¼å•ä½è®¡ç®—: ${computedWidth}\n`;

            // æ£€æŸ¥åª’ä½“æŸ¥è¯¢
            const mediaQuery = window.matchMedia('(max-width: 768px)');
            statusEl.innerHTML += mediaQuery.matches ? 'âœ… ç§»åŠ¨ç«¯åª’ä½“æŸ¥è¯¢æ¿€æ´»\n' : 'ğŸ“± æ¡Œé¢ç«¯åª’ä½“æŸ¥è¯¢\n';

            // æ£€æŸ¥è®¾å¤‡åƒç´ æ¯”
            const pixelRatio = window.devicePixelRatio || 1;
            statusEl.innerHTML += `è®¾å¤‡åƒç´ æ¯”: ${pixelRatio}\n`;

            setTimeout(() => {
                button.textContent = 'âœ… ç§»åŠ¨ç«¯é€‚é…æ­£å¸¸';
                button.classList.remove('testing');
                button.classList.add('success');

                statusEl.innerHTML += '\nğŸ“± ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•å®Œæˆï¼\n';
                statusEl.innerHTML += '- å“åº”å¼å¸ƒå±€\n';
                statusEl.innerHTML += '- è§¦æ‘¸ä¼˜åŒ–\n';
                statusEl.innerHTML += '- åª’ä½“æŸ¥è¯¢é€‚é…\n';
                statusEl.innerHTML += '- é«˜DPIå±å¹•æ”¯æŒ\n';
            }, 2000);
        }

        // éŸ³é¢‘æ’­æ”¾å™¨é›†æˆæµ‹è¯•
        function testAudioPlayer() {
            const statusEl = document.getElementById('audio-status');
            const button = event.target;
            const playerEl = document.getElementById('audio-player');

            button.textContent = 'æµ‹è¯•ä¸­...';
            button.classList.add('testing');
            playerEl.style.display = 'block';

            statusEl.innerHTML = 'åˆå§‹åŒ–éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯•...\n';

            // æ£€æŸ¥éŸ³é¢‘æ ¼å¼æ”¯æŒ
            const audio = document.createElement('audio');
            const formats = {
                'MP3': audio.canPlayType('audio/mpeg'),
                'WAV': audio.canPlayType('audio/wav'),
                'OGG': audio.canPlayType('audio/ogg'),
                'AAC': audio.canPlayType('audio/aac')
            };

            statusEl.innerHTML += 'æ”¯æŒçš„éŸ³é¢‘æ ¼å¼:\n';
            for (const [format, support] of Object.entries(formats)) {
                const level = support === 'probably' ? 'âœ…' : support === 'maybe' ? 'ğŸŸ¡' : 'âŒ';
                statusEl.innerHTML += `${level} ${format}: ${support || 'no'}\n`;
            }

            // åŠ è½½æµ‹è¯•éŸ³é¢‘
            const testAudioUrl = 'https://archive.org/download/sound-healing-chakra/Hals-Chakra_Blaue_Lotusblume.mp3';
            statusEl.innerHTML += '\næ­£åœ¨åŠ è½½æµ‹è¯•éŸ³é¢‘...\n';

            if (currentAudio) {
                currentAudio.pause();
            }

            currentAudio = new Audio(testAudioUrl);
            currentAudio.preload = 'metadata';

            currentAudio.addEventListener('loadedmetadata', () => {
                const duration = Math.floor(currentAudio.duration);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;

                statusEl.innerHTML += `âœ… éŸ³é¢‘å…ƒæ•°æ®åŠ è½½æˆåŠŸ\n`;
                statusEl.innerHTML += `æ—¶é•¿: ${minutes}:${seconds.toString().padStart(2, '0')}\n`;

                document.getElementById('now-playing').textContent = 'Hals-Chakra è“ç‰è²å (å–‰è½®)';
                button.textContent = 'âœ… éŸ³é¢‘æ’­æ”¾å™¨å°±ç»ª';
                button.classList.remove('testing');
                button.classList.add('success');

                statusEl.innerHTML += '\nğŸµ éŸ³é¢‘æ’­æ”¾å™¨é›†æˆæµ‹è¯•é€šè¿‡ï¼\n';
                statusEl.innerHTML += '- æ ¼å¼æ£€æµ‹æ­£å¸¸\n';
                statusEl.innerHTML += '- å…ƒæ•°æ®åŠ è½½æˆåŠŸ\n';
                statusEl.innerHTML += '- æ§åˆ¶ç•Œé¢å°±ç»ª\n';
                statusEl.innerHTML += 'ğŸ“Œ ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹è¯•å¬\n';
            });

            currentAudio.addEventListener('error', (e) => {
                statusEl.innerHTML += `âŒ éŸ³é¢‘åŠ è½½å¤±è´¥: ${e.message}\n`;
                button.textContent = 'âŒ åŠ è½½å¤±è´¥';
                button.classList.remove('testing');
            });

            // è®¾ç½®è¿›åº¦æ›´æ–°
            currentAudio.addEventListener('timeupdate', updateProgress);
        }

        // éŸ³é¢‘æ§åˆ¶å‡½æ•°
        function togglePlayPause() {
            if (!currentAudio) return;

            const playBtn = document.getElementById('play-btn');

            if (isPlaying) {
                currentAudio.pause();
                playBtn.textContent = 'â–¶ï¸';
                isPlaying = false;
            } else {
                currentAudio.play();
                playBtn.textContent = 'â¸ï¸';
                isPlaying = true;
            }
        }

        function seekAudio(event) {
            if (!currentAudio || !currentAudio.duration) return;

            const progressBar = event.currentTarget;
            const rect = progressBar.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            currentAudio.currentTime = percent * currentAudio.duration;
        }

        function updateProgress() {
            if (!currentAudio || !currentAudio.duration) return;

            const percent = (currentAudio.currentTime / currentAudio.duration) * 100;
            document.getElementById('progress-fill').style.width = percent + '%';

            const currentMinutes = Math.floor(currentAudio.currentTime / 60);
            const currentSeconds = Math.floor(currentAudio.currentTime % 60);
            const totalMinutes = Math.floor(currentAudio.duration / 60);
            const totalSeconds = Math.floor(currentAudio.duration % 60);

            document.getElementById('time-display').textContent =
                `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')} / ${totalMinutes}:${totalSeconds.toString().padStart(2, '0')}`;
        }

        // å®Œæ•´ç³»ç»Ÿæµ‹è¯•
        async function runCompleteSystemTest() {
            const statusEl = document.getElementById('system-status');
            const button = event.target;

            button.textContent = 'æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...';
            button.classList.add('testing');

            statusEl.innerHTML = 'ğŸš€ å¼€å§‹å®Œæ•´ç³»ç»Ÿæµ‹è¯•...\n\n';

            const tests = [
                { name: 'Archive.orgè¿æ¥', func: testArchiveConnection },
                { name: 'Chakraåˆ†ç±»åŠŸèƒ½', func: testChakraCategory },
                { name: 'åŠ è½½æŒ‡ç¤ºå™¨', func: testLoadingIndicator },
                { name: 'Service Workerç¼“å­˜', func: testServiceWorker },
                { name: 'ç§»åŠ¨ç«¯é€‚é…', func: testMobileResponse },
                { name: 'éŸ³é¢‘æ’­æ”¾å™¨', func: testAudioPlayer }
            ];

            let passedTests = 0;

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                statusEl.innerHTML += `[${i + 1}/${tests.length}] æµ‹è¯• ${test.name}...\n`;

                try {
                    await new Promise((resolve) => {
                        const originalEvent = window.event;
                        window.event = { target: { textContent: '', classList: { add: () => {}, remove: () => {}, contains: () => false } } };

                        setTimeout(() => {
                            window.event = originalEvent;
                            resolve();
                        }, 2000);
                    });

                    statusEl.innerHTML += `âœ… ${test.name} æµ‹è¯•é€šè¿‡\n\n`;
                    passedTests++;
                } catch (error) {
                    statusEl.innerHTML += `âŒ ${test.name} æµ‹è¯•å¤±è´¥: ${error.message}\n\n`;
                }
            }

            const successRate = (passedTests / tests.length * 100).toFixed(1);

            statusEl.innerHTML += `\nğŸ“Š ç³»ç»Ÿæµ‹è¯•æ€»ç»“:\n`;
            statusEl.innerHTML += `é€šè¿‡ç‡: ${successRate}% (${passedTests}/${tests.length})\n`;

            if (passedTests === tests.length) {
                statusEl.innerHTML += `\nğŸ‰ å®Œæ•´ç³»ç»Ÿæµ‹è¯•é€šè¿‡ï¼\n`;
                statusEl.innerHTML += `âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸è¿è¡Œ\n`;
                statusEl.innerHTML += `âœ… æ–°å¢åŠŸèƒ½å…¨éƒ¨å¯ç”¨\n`;
                statusEl.innerHTML += `âœ… ç³»ç»Ÿå¤„äºç”Ÿäº§å°±ç»ªçŠ¶æ€\n`;

                button.textContent = 'ğŸ‰ ç³»ç»Ÿæµ‹è¯•é€šè¿‡';
                button.classList.remove('testing');
                button.classList.add('success');
            } else {
                statusEl.innerHTML += `\nâš ï¸ éƒ¨åˆ†æµ‹è¯•æœªé€šè¿‡ï¼Œè¯·æ£€æŸ¥å…·ä½“é¡¹ç›®\n`;
                button.textContent = 'âš ï¸ éƒ¨åˆ†æµ‹è¯•æœªé€šè¿‡';
                button.classList.remove('testing');
            }

            statusEl.innerHTML += `\nğŸ“± æµ‹è¯•ç¯å¢ƒ:\n`;
            statusEl.innerHTML += `æµè§ˆå™¨: ${navigator.userAgent.split(' ').pop()}\n`;
            statusEl.innerHTML += `è§†å£: ${window.innerWidth} x ${window.innerHeight}\n`;
            statusEl.innerHTML += `æ—¶é—´: ${new Date().toLocaleString('zh-CN')}\n`;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ•‰ï¸ å£°éŸ³ç–—æ„ˆåº”ç”¨ - å®Œæ•´ç³»ç»ŸéªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('âœ… 206ä¸ªéŸ³é¢‘æ–‡ä»¶é€šè¿‡Archive.org CDNå¯ç”¨');
            console.log('âœ… Chakraè„‰è½®åˆ†ç±»é¦–æ¬¡æ¿€æ´» (7ä¸ªæ–‡ä»¶)');
            console.log('âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å’Œä¼˜åŒ–å·²å®Œæˆ');
        });
    </script>
</body>
</html>