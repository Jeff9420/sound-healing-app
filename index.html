<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>声音疗愈</title>

  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src 'self' https: data:; connect-src 'self' https:; img-src 'self' data: https:;">

  <!-- SEO and Performance -->
  <meta name="description" content="声音疗愈空间 - 专业的音频疗愈平台，提供多种疗愈音频类型，帮助您放松身心，回归宁静">
  <meta name="keywords" content="声音疗愈,音频疗愈,冥想,放松,减压,自然音效">
  <meta name="robots" content="index,follow">
  <link rel="canonical" href="https://soundflows.app">
  <link rel="stylesheet" href="assets/css/app.css" />
  <script src="assets/js/audio-config.js"></script>

</head>
<body>
  <!-- Fallback for users without JavaScript -->
  <noscript>
    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); display: flex; align-items: center; justify-content: center; z-index: 9999;">
      <div style="background: rgba(255,255,255,0.95); padding: 40px; border-radius: 15px; text-align: center; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        <h1 style="color: #333; margin-bottom: 20px;">🌸 声音疗愈空间</h1>
        <p style="color: #666; line-height: 1.6; margin-bottom: 20px;">此应用需要启用JavaScript才能正常运行。<br/>请在浏览器设置中启用JavaScript后刷新页面。</p>
        <p style="color: #999; font-size: 14px;"><strong>Sound Healing Space</strong><br/>This application requires JavaScript to function properly.</p>
      </div>
    </div>
  </noscript>
  <div class="mountain" aria-hidden="true"></div>

  <div class="grid">
    <div class="panel left-span healing-dashboard">
      <div class="dashboard-content">
        <!-- 品牌标识区 -->
        <div class="brand-section">
          <div class="brand-icon">🌸</div>
          <div class="brand-info">
            <div class="brand-title" data-i18n="brand-title">声音疗愈空间</div>
            <div class="brand-subtitle" data-i18n="brand-subtitle">让心灵回归宁静</div>
          </div>
          <div class="language-selector">
            <button type="button" id="languageToggle" class="language-btn">
              <span class="language-icon">🌐</span>
              <span class="language-text" id="currentLanguage">中文</span>
            </button>
          </div>
        </div>

        <!-- 当前状态卡片 -->
        <div class="status-cards">
          <div class="status-card current-theme">
            <div class="card-icon" id="currentThemeIcon">🎵</div>
            <div class="card-content">
              <div class="card-label" data-i18n="current-theme">当前主题</div>
              <div class="card-value" id="currentThemeName" data-i18n="select-theme">请选择主题</div>
              <div class="card-extra" id="currentThemeCount" data-i18n="start-journey">开始您的疗愈之旅</div>
            </div>
          </div>

          <div class="status-card playback-state">
            <div class="card-icon" id="playbackIcon">⏸️</div>
            <div class="card-content">
              <div class="card-label" data-i18n="playback-status">播放状态</div>
              <div class="card-value" id="playbackStatus" data-i18n="paused">暂停</div>
              <div class="card-extra" id="playbackExtra" data-i18n="ready-to-heal">准备开始疗愈</div>
            </div>
          </div>

          <div class="status-card session-info">
            <div class="card-icon">⏰</div>
            <div class="card-content">
              <div class="card-label" data-i18n="session-info">本次会话</div>
              <div class="card-value" id="uptime">--</div>
              <div class="card-extra" data-i18n="healing-time">专注疗愈时光</div>
            </div>
          </div>
        </div>

        <!-- 振幅可视化显示 -->
        <div class="amplitude-visualization">
          <canvas id="mainAmplitudeCanvas" width="400" height="120"></canvas>
        </div>

        <!-- 温馨提示 -->
        <div class="healing-tip">
          <div class="tip-icon">💡</div>
          <div class="tip-text" data-i18n="headphone-tip">使用耳机获得最佳疗愈体验</div>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="right-top">
        <div class="panel nature-scene">
          <div class="title" data-i18n="theme-scene">主题场景</div>
          <div class="chrome"><i></i><i></i><i></i></div>

          <!-- 自然动画背景 -->
          <div class="scene-container" id="sceneContainer">
            <canvas id="natureCanvas"></canvas>

            <!-- 浮动粒子层 -->
            <div class="floating-particles" id="floatingParticles"></div>

            <!-- 主题切换控制器 -->
            <div class="theme-selector">
              <button type="button" class="theme-nav-btn" id="carouselPrev">←</button>
              <div class="theme-info">
                <div class="theme-current" id="carouselActiveName" data-i18n="select-theme">请选择主题</div>
                <div class="theme-hint" id="scene-description" data-i18n="click-to-switch">点击切换场景</div>
              </div>
              <button type="button" class="theme-nav-btn" id="carouselNext">→</button>
            </div>

            <!-- 主题图标显示 -->
            <div class="scene-icon" id="sceneIcon">🎵</div>
          </div>
        </div>

        <div class="panel clock-panel">
          <div class="clock">
            <div class="time" id="bigClock">--:--</div>
            <div class="date" id="dateStr">----</div>
          </div>
        </div>
      </div>

      <div class="right-bottom">
        <div class="panel audio-controller">
          <div class="audio-content">
            <!-- 当前播放信息 -->
            <div class="now-playing-section">
              <div class="track-info">
                <div class="track-title" id="nowPlayingTitle" data-i18n="not-playing">暂未播放</div>
                <div class="track-theme" id="nowPlayingCategory" data-i18n="select-theme-to-start">请选择主题开始疗愈</div>
              </div>
              <div class="playback-icon">🎵</div>
            </div>

            <!-- 进度条 -->
            <div class="progress-section" role="group" aria-label="播放进度">
              <div class="time-info" role="timer" aria-label="播放时间">
                <div class="current-time" id="currentTime" aria-label="当前播放时间">00:00</div>
                <div class="total-time" id="totalTime" aria-label="总播放时长">--:--</div>
              </div>
              <div class="progress-bar-container"
                   id="progressContainer"
                   role="slider"
                   aria-label="播放进度控制"
                   aria-valuemin="0"
                   aria-valuemax="100"
                   aria-valuenow="0"
                   aria-valuetext="0%"
                   tabindex="0"
                   aria-describedby="currentTime totalTime">
                <div class="progress-bar-track">
                  <div class="progress-bar-fill" id="progressDisplay" aria-hidden="true"></div>
                  <div class="progress-bar-thumb" id="progressThumb" aria-hidden="true"></div>
                </div>
              </div>
            </div>

            <!-- 播放控制 -->
            <div class="control-section" role="group" aria-label="播放控制">
              <button type="button"
                      class="control-btn secondary"
                      id="prevBtn"
                      aria-label="播放上一首音轨"
                      aria-keyshortcuts="Ctrl+ArrowLeft">
                <span class="control-icon" aria-hidden="true">⏮</span>
                <span class="control-label" data-i18n="previous">上一首</span>
              </button>

              <button type="button"
                      class="control-btn primary"
                      id="playPauseBtn"
                      aria-label="播放/暂停音频"
                      aria-pressed="false"
                      aria-keyshortcuts="Space">
                <span class="control-icon" aria-hidden="true">▶️</span>
                <span class="control-label" data-i18n="play">播放</span>
              </button>

              <button type="button"
                      class="control-btn secondary"
                      id="nextBtn"
                      aria-label="播放下一首音轨"
                      aria-keyshortcuts="Ctrl+ArrowRight">
                <span class="control-icon" aria-hidden="true">⏭</span>
                <span class="control-label" data-i18n="next">下一首</span>
              </button>
            </div>

            <!-- 音量和计时器 -->
            <div class="settings-section" role="group" aria-label="音频设置控制">
              <div class="volume-control">
                <span class="setting-icon" aria-hidden="true">🔊</span>
                <input type="range"
                       id="volumeRange"
                       min="0"
                       max="100"
                       value="50"
                       step="1"
                       class="healing-slider"
                       aria-label="音量控制"
                       aria-describedby="volumeValue" />
                <span class="volume-value" id="volumeValue" aria-live="polite">50%</span>
              </div>

              <div class="timer-control">
                <span class="setting-icon" aria-hidden="true">⏰</span>
                <select id="timerSelect"
                        class="healing-select"
                        aria-label="定时器设置">
                  <option value="0" data-i18n="timer-no-limit">无限制</option>
                  <option value="15" data-i18n="timer-15min">15分钟</option>
                  <option value="30" data-i18n="timer-30min">30分钟</option>
                  <option value="60" data-i18n="timer-60min">60分钟</option>
                  <option value="90" data-i18n="timer-90min">90分钟</option>
                </select>
                <span class="timer-status" id="timerStatus" data-i18n="timer-disabled" aria-live="polite">未开启</span>
              </div>

              <!-- 播放模式控制 -->
              <div class="playback-modes" role="group" aria-label="播放模式">
                <button type="button"
                        class="mode-btn"
                        id="shuffleBtnVisible"
                        data-mode="shuffle"
                        aria-pressed="false"
                        aria-label="随机播放模式">
                  <span class="mode-icon" aria-hidden="true">🔀</span>
                  <span class="mode-label" data-i18n="shuffle">随机</span>
                </button>

                <button type="button"
                        class="mode-btn"
                        id="repeatBtnVisible"
                        data-mode="repeat"
                        aria-pressed="false"
                        aria-label="循环播放模式">
                  <span class="mode-icon" aria-hidden="true">🔁</span>
                  <span class="mode-label" data-i18n="repeat">循环</span>
                </button>
              </div>
            </div>

            <!-- 隐藏的原始控件用于功能保持 -->
            <div style="display: none;">
              <input type="range" id="progressRange" min="0" max="0" value="0" step="1" />
              <button type="button" id="shuffleBtn"></button>
              <button type="button" id="repeatBtn"></button>
            </div>
          </div>
        </div>

        <div class="panel notes-panel">
          <div class="term">
            <div class="editor" contenteditable="false" style="font-size: 11px; line-height: 1.3; max-height: 160px; overflow-y: auto;">
              <div id="trackList" style="color: #d3dde8;">
                <!-- Default content to prevent layout shift and improve first-screen rendering -->
                <div style="color: #aab3be; margin-bottom: 8px;" data-i18n="select-theme-for-tracklist">请选择主题查看音轨列表</div>
                <div class="loading-placeholder" style="color: #8a94a0; font-size: 10px; line-height: 1.4;">
                  <div style="margin-bottom: 4px;">🎵 Available Categories:</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Animal sounds (26 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Chakra healing (7 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Fire sounds (4 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Hypnosis (70 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Meditation (14 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Rain sounds (14 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Running water (6 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Singing bowl (61 tracks)</div>
                  <div style="margin-left: 8px; margin-bottom: 2px;">• Subconscious therapy (11 tracks)</div>
                  <div style="margin-top: 6px; font-size: 9px; opacity: 0.7;">Total: 213+ healing tracks</div>
                </div>
              </div>

              <!-- 播放列表控制 -->
              <div style="margin-top: 12px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.1);">
                <button type="button" id="playFirstBtn" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-right: 8px;" data-i18n="play-all">播放全部</button>
                <button type="button" id="togglePlaylistBtn" style="background: rgba(255,255,255,0.1); border: none; color: white; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 11px;" data-i18n="toggle-display">切换显示</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 品牌标识 -->
  <div class="brand-signature">
    声音疗愈空间 <span class="theme-accent-dot"></span>
  </div>

  <script src="assets/js/app-new-ui.js"></script>
</body>
</html>
