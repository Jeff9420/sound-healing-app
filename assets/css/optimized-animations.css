/**
 * GPU加速动画优化 - 声音疗愈应用专用
 * 减少重绘重排，提升动画性能
 */

/* =============================================
   GPU加速基础设置
   ============================================= */

/* 为所有动画元素启用硬件加速 */
.cloud,
.ripple,
.tree-logo,
.ecosystem-card,
.lotus-player,
.nature-progress-slider,
.background-scene {
    will-change: transform, opacity;
    transform: translateZ(0); /* 强制GPU层 */
    backface-visibility: hidden;
    perspective: 1000px;
}

/* =============================================
   云朵动画优化
   ============================================= */

.clouds {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    /* GPU层分离 */
    transform: translateZ(0);
}

.cloud {
    position: absolute;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 50px;
    opacity: 0.6;
    /* 使用transform代替left/top变化 */
    animation: float-cloud-gpu 45s infinite linear;
    /* 优化渲染性能 */
    contain: layout style paint;
}

/* GPU优化的云朵浮动动画 */
@keyframes float-cloud-gpu {
    0% { 
        transform: translateX(-200px) translateZ(0);
        opacity: 0;
    }
    10% { 
        opacity: 0.6;
    }
    90% { 
        opacity: 0.6;
    }
    100% { 
        transform: translateX(calc(100vw + 200px)) translateZ(0);
        opacity: 0;
    }
}

/* 云朵形状伪元素优化 */
.cloud:before,
.cloud:after {
    content: '';
    position: absolute;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 50px;
    /* 避免伪元素引起的重绘 */
    transform: translateZ(0);
}

/* =============================================
   池塘涟漪效果优化
   ============================================= */

.pond-player {
    position: relative;
    /* 创建新的层叠上下文 */
    transform: translateZ(0);
    contain: layout style paint;
}

.ripple {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    border: 2px solid rgba(127, 176, 105, 0.4);
    border-radius: 50%;
    /* 使用transform居中，避免重排 */
    transform: translate(-50%, -50%) translateZ(0);
    animation: ripple-gpu 3s infinite ease-out;
    pointer-events: none;
}

/* GPU优化的涟漪动画 */
@keyframes ripple-gpu {
    0% {
        transform: translate(-50%, -50%) scale(1) translateZ(0);
        opacity: 1;
    }
    100% {
        transform: translate(-50%, -50%) scale(8) translateZ(0);
        opacity: 0;
    }
}

/* =============================================
   生态系统卡片动画优化
   ============================================= */

.ecosystem-grid {
    display: grid;
    gap: 1.5rem;
    /* 网格容器优化 */
    contain: layout style;
}

.ecosystem-card {
    background: rgba(45, 74, 45, 0.8);
    border-radius: var(--nature-radius);
    padding: 1.5rem;
    cursor: pointer;
    /* GPU加速变换 */
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform: translateZ(0);
    /* 避免layout thrashing */
    contain: layout style paint;
}

.ecosystem-card:hover {
    /* 仅使用transform，避免重排 */
    transform: translateY(-8px) translateZ(0) scale(1.02);
    box-shadow: 
        0 12px 24px rgba(26, 46, 26, 0.3),
        0 6px 12px rgba(26, 46, 26, 0.2);
}

.ecosystem-card:active {
    transform: translateY(-4px) translateZ(0) scale(0.98);
}

/* =============================================
   按钮交互动画优化
   ============================================= */

.lotus-player,
.nature-control-btn,
.nature-button {
    /* 预分配GPU层 */
    transform: translateZ(0);
    transition: transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    contain: layout style paint;
}

.lotus-player:hover {
    transform: translateZ(0) scale(1.1);
    box-shadow: 0 8px 16px rgba(26, 46, 26, 0.3);
}

.lotus-player:active {
    transform: translateZ(0) scale(0.95);
}

/* =============================================
   进度条滑块优化
   ============================================= */

.nature-progress-slider,
.nature-slider {
    /* 优化滑块拖拽性能 */
    transform: translateZ(0);
    contain: layout style;
}

.nature-progress-slider::-webkit-slider-thumb,
.nature-slider::-webkit-slider-thumb {
    transition: transform 0.15s ease-out;
    transform: translateZ(0);
}

.nature-progress-slider::-webkit-slider-thumb:hover,
.nature-slider::-webkit-slider-thumb:hover {
    transform: translateZ(0) scale(1.2);
}

/* =============================================
   文本和标题动画优化
   ============================================= */

.nature-title,
.path-title,
.habitat-title {
    /* 文本渲染优化 */
    text-rendering: optimizeSpeed;
    font-display: swap;
    /* 避免文本重排 */
    contain: layout style;
}

/* 标题淡入动画 */
@keyframes fadeInUp {
    0% {
        opacity: 0;
        transform: translateY(30px) translateZ(0);
    }
    100% {
        opacity: 1;
        transform: translateY(0) translateZ(0);
    }
}

.fade-in-up {
    animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* =============================================
   背景场景画布优化
   ============================================= */

.background-scene {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -2;
    /* 硬件加速画布 */
    transform: translateZ(0);
    /* 优化画布渲染 */
    image-rendering: optimizeSpeed;
    contain: layout style paint;
}

/* =============================================
   性能优化类
   ============================================= */

/* 低性能设备适配 */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
}

/* 低电量模式优化 */
.low-power-mode .cloud,
.low-power-mode .ripple,
.low-power-mode .background-scene {
    animation: none !important;
    display: none !important;
}

/* 慢速网络适配 */
.low-bandwidth .ecosystem-card {
    transition: none;
}

.low-bandwidth .ecosystem-card:hover {
    transform: none;
    box-shadow: none;
}

/* =============================================
   GPU层管理
   ============================================= */

/* 高频更新元素的层分离 */
.high-frequency-update {
    will-change: transform;
    transform: translateZ(0);
    isolation: isolate;
}

/* 动画结束后清理will-change */
.animation-complete {
    will-change: auto;
}

/* =============================================
   响应式动画优化
   ============================================= */

/* 移动设备动画简化 */
@media (max-width: 768px) {
    .cloud {
        animation-duration: 60s; /* 减慢动画降低CPU使用 */
    }
    
    .ripple {
        animation-duration: 4s;
    }
    
    .ecosystem-card {
        transition-duration: 0.2s;
    }
    
    .ecosystem-card:hover {
        transform: translateY(-4px) translateZ(0); /* 减少移动量 */
    }
}

/* 超小屏设备进一步优化 */
@media (max-width: 480px) {
    .cloud,
    .background-scene {
        display: none; /* 隐藏装饰性动画 */
    }
    
    .ecosystem-card:hover {
        transform: none; /* 取消悬停效果 */
    }
}

/* =============================================
   动画性能监控
   ============================================= */

/* 开发调试：显示GPU层 - 默认隐藏 */
.debug-layers {
    display: none !important;
}

.debug-layers.active * {
    outline: 1px solid rgba(255, 0, 0, 0.3);
}

.debug-layers.active .cloud {
    outline: 1px solid rgba(0, 255, 0, 0.5);
}

.debug-layers.active .ecosystem-card {
    outline: 1px solid rgba(0, 0, 255, 0.5);
}

/* =============================================
   关键帧动画集合
   ============================================= */

/* 加载动画 */
@keyframes pulse {
    0%, 100% {
        transform: translateZ(0) scale(1);
        opacity: 1;
    }
    50% {
        transform: translateZ(0) scale(1.05);
        opacity: 0.8;
    }
}

/* 呼吸效果 */
@keyframes breathe {
    0%, 100% {
        transform: translateZ(0) scale(1);
    }
    50% {
        transform: translateZ(0) scale(1.02);
    }
}

/* 微妙摇摆 */
@keyframes gentle-sway {
    0%, 100% {
        transform: translateZ(0) rotate(0deg);
    }
    25% {
        transform: translateZ(0) rotate(1deg);
    }
    75% {
        transform: translateZ(0) rotate(-1deg);
    }
}

/* 工具类动画 */
.pulse { animation: pulse 2s infinite ease-in-out; }
.breathe { animation: breathe 4s infinite ease-in-out; }
.gentle-sway { animation: gentle-sway 6s infinite ease-in-out; }