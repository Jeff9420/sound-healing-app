<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>i18n Diagnostic - Check Translation Loading</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1a0f0a;
            color: #fdf3e5;
            padding: 2rem;
            line-height: 1.8;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(11, 7, 4, 0.8);
            border: 2px solid rgba(102, 102, 255, 0.3);
            border-radius: 12px;
            padding: 2rem;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #6666ff;
        }

        .section {
            background: rgba(26, 15, 10, 0.6);
            border-left: 4px solid #f6a93b;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
        }

        .section h2 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #f6a93b;
        }

        .check-item {
            padding: 0.75rem;
            margin: 0.5rem 0;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .check-pass {
            background: rgba(34, 197, 94, 0.2);
            border-left: 4px solid #22c55e;
            color: #86efac;
        }

        .check-fail {
            background: rgba(239, 68, 68, 0.2);
            border-left: 4px solid #ef4444;
            color: #fca5a5;
        }

        .check-warn {
            background: rgba(234, 179, 8, 0.2);
            border-left: 4px solid #eab308;
            color: #fde047;
        }

        pre {
            background: rgba(11, 7, 4, 0.9);
            border: 1px solid rgba(253, 243, 229, 0.2);
            border-radius: 6px;
            padding: 1rem;
            overflow-x: auto;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            color: #a3e635;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-card {
            background: rgba(102, 102, 255, 0.1);
            border: 1px solid rgba(102, 102, 255, 0.3);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85rem;
            color: rgba(253, 243, 229, 0.7);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #6666ff;
        }

        button {
            background: #6666ff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #5555ee;
            transform: translateY(-2px);
        }

        .instructions {
            background: rgba(246, 169, 59, 0.1);
            border: 1px solid rgba(246, 169, 59, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .instructions h3 {
            color: #f6a93b;
            margin-bottom: 1rem;
        }

        .instructions ol {
            margin-left: 1.5rem;
        }

        .instructions li {
            margin: 0.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç i18n Translation System Diagnostic</h1>
        <p style="margin-bottom: 2rem; color: rgba(253, 243, 229, 0.7);">
            This page checks if all translation files are loaded correctly and diagnoses any issues.
        </p>

        <div id="diagnosticResults">
            <div class="check-item check-warn">‚è≥ Running diagnostics...</div>
        </div>

        <div class="instructions">
            <h3>üìã If you see errors:</h3>
            <ol>
                <li><strong>Hard refresh your browser:</strong> Press <code>Ctrl+Shift+R</code> (Windows) or <code>Cmd+Shift+R</code> (Mac)</li>
                <li><strong>Clear browser cache:</strong> Press <code>Ctrl+Shift+Delete</code> and clear cached files</li>
                <li><strong>Check browser console:</strong> Press <code>F12</code> and look at the Console tab for errors</li>
                <li><strong>Verify files exist:</strong> Make sure all JS files are in <code>assets/js/</code> folder</li>
                <li><strong>Update from GitHub:</strong> Run <code>git pull origin main</code> to get latest code</li>
            </ol>
        </div>

        <div style="margin-top: 2rem;">
            <button onclick="location.reload()">üîÑ Re-run Diagnostic</button>
            <button onclick="window.open('i18n-test.html', '_blank')">‚ñ∂Ô∏è Open Test Suite</button>
            <button onclick="window.open('saas-landing.html', '_blank')">üåê Open Landing Page</button>
        </div>
    </div>

    <!-- i18n Scripts (in correct order) -->
    <script src="assets/js/i18n-system.js"></script>
    <script src="assets/js/i18n-translations-addon.js"></script>
    <script src="assets/js/i18n-saas-extensions.js"></script>
    <script src="assets/js/i18n-saas-complete-translations.js"></script>
    <script src="assets/js/i18n-saas-integrator.js"></script>

    <!-- Diagnostic Script -->
    <script>
        (function() {
            'use strict';

            const resultsContainer = document.getElementById('diagnosticResults');

            function addResult(message, type = 'pass') {
                const div = document.createElement('div');
                div.className = `check-item check-${type}`;
                div.innerHTML = message;
                resultsContainer.appendChild(div);
            }

            function addSection(title) {
                const section = document.createElement('div');
                section.className = 'section';
                section.innerHTML = `<h2>${title}</h2>`;
                resultsContainer.appendChild(section);
                return section;
            }

            function runDiagnostics() {
                resultsContainer.innerHTML = '';

                // 1. Check i18n system
                const section1 = addSection('1Ô∏è‚É£ Core i18n System');
                if (typeof window.i18n !== 'undefined') {
                    addResult('‚úÖ window.i18n is loaded', 'pass');
                    addResult(`‚úÖ Current language: <strong>${window.i18n.currentLanguage}</strong>`, 'pass');
                    addResult(`‚úÖ Loaded languages: <strong>${Array.from(window.i18n.loadedLanguages).join(', ')}</strong>`, 'pass');
                } else {
                    addResult('‚ùå window.i18n is NOT loaded - i18n-system.js failed to load!', 'fail');
                    return;
                }

                // 2. Check translation sources
                const section2 = addSection('2Ô∏è‚É£ Translation Data Sources');

                const hasBasic = typeof window.SAAS_TRANSLATIONS !== 'undefined';
                const hasComplete = typeof window.SAAS_COMPLETE_TRANSLATIONS !== 'undefined';

                if (hasBasic) {
                    const langs = Object.keys(window.SAAS_TRANSLATIONS);
                    addResult(`‚úÖ SAAS_TRANSLATIONS loaded: ${langs.join(', ')}`, 'pass');
                } else {
                    addResult('‚ùå SAAS_TRANSLATIONS not found - i18n-saas-extensions.js failed to load!', 'fail');
                }

                if (hasComplete) {
                    const langs = Object.keys(window.SAAS_COMPLETE_TRANSLATIONS);
                    addResult(`‚úÖ SAAS_COMPLETE_TRANSLATIONS loaded: ${langs.join(', ')}`, 'pass');
                } else {
                    addResult('‚ùå SAAS_COMPLETE_TRANSLATIONS not found - i18n-saas-complete-translations.js failed to load!', 'fail');
                }

                if (!hasBasic && !hasComplete) {
                    addResult('‚ö†Ô∏è WARNING: No SaaS translations loaded! Your browser may have cached old files.', 'warn');
                    return;
                }

                // 3. Check translation counts
                const section3 = addSection('3Ô∏è‚É£ Translation Counts Per Language');

                const statsDiv = document.createElement('div');
                statsDiv.className = 'stats-grid';

                window.i18n.loadedLanguages.forEach(lang => {
                    const translations = window.i18n.translations.get(lang);
                    const count = translations ? Object.keys(translations).length : 0;

                    const statCard = document.createElement('div');
                    statCard.className = 'stat-card';
                    statCard.innerHTML = `
                        <div class="stat-label">${lang}</div>
                        <div class="stat-value">${count}</div>
                        <div class="stat-label">translation keys</div>
                    `;
                    statsDiv.appendChild(statCard);

                    // Check if count is reasonable
                    if (count < 100) {
                        addResult(`‚ö†Ô∏è ${lang}: Only ${count} keys (expected 600-700+). Translations may not be merged!`, 'warn');
                    } else if (count < 500) {
                        addResult(`‚ö†Ô∏è ${lang}: ${count} keys (expected 600-700+). Some translations may be missing.`, 'warn');
                    } else {
                        addResult(`‚úÖ ${lang}: ${count} keys - looks good!`, 'pass');
                    }
                });

                section3.appendChild(statsDiv);

                // 4. Test specific keys
                const section4 = addSection('4Ô∏è‚É£ Sample Translation Tests');

                const testKeys = [
                    { key: 'benefits.title', name: 'Benefits Section Title' },
                    { key: 'features.timer.title', name: 'Timer Feature Title' },
                    { key: 'pricing.title', name: 'Pricing Section Title' },
                    { key: 'faq.q1.question', name: 'FAQ Question 1' },
                    { key: 'footer.brand.tagline', name: 'Footer Tagline' }
                ];

                let testsPassed = 0;
                let testsFailed = 0;

                testKeys.forEach(({ key, name }) => {
                    const value = window.i18n.t(key);
                    if (value && value !== key) {
                        addResult(`‚úÖ ${name}: "${value.substring(0, 50)}${value.length > 50 ? '...' : ''}"`, 'pass');
                        testsPassed++;
                    } else {
                        addResult(`‚ùå ${name}: Missing (key: ${key})`, 'fail');
                        testsFailed++;
                    }
                });

                // 5. Integration status
                const section5 = addSection('5Ô∏è‚É£ Final Diagnosis');

                if (testsPassed === testKeys.length) {
                    addResult(`üéâ <strong>ALL TESTS PASSED!</strong> Translation system is working correctly. You should see 100% coverage in the test suite.`, 'pass');
                } else if (testsPassed > 0) {
                    addResult(`‚ö†Ô∏è <strong>PARTIAL SUCCESS</strong>: ${testsPassed}/${testKeys.length} tests passed. Some translations may be missing.`, 'warn');
                } else {
                    addResult(`‚ùå <strong>SYSTEM FAILURE</strong>: All tests failed. Please check browser console (F12) for errors.`, 'fail');
                }

                // Check if integrator ran
                if (hasBasic && hasComplete) {
                    addResult(`üí° <strong>TIP:</strong> Open browser console (F12) and check for messages from i18n-saas-integrator.js. You should see "Ê£ÄÊµãÂà∞ÁøªËØëÊ∫ê: SAAS_TRANSLATIONS, SAAS_COMPLETE_TRANSLATIONS" and merge statistics.`, 'warn');
                }

                // 6. Raw data inspection
                const section6 = addSection('6Ô∏è‚É£ Raw Data (for debugging)');

                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify({
                    i18nLoaded: typeof window.i18n !== 'undefined',
                    currentLanguage: window.i18n?.currentLanguage,
                    loadedLanguages: window.i18n ? Array.from(window.i18n.loadedLanguages) : [],
                    hasBasicTranslations: hasBasic,
                    hasCompleteTranslations: hasComplete,
                    translationCounts: (() => {
                        const counts = {};
                        window.i18n?.loadedLanguages.forEach(lang => {
                            const t = window.i18n.translations.get(lang);
                            counts[lang] = t ? Object.keys(t).length : 0;
                        });
                        return counts;
                    })()
                }, null, 2);
                section6.appendChild(pre);
            }

            // Wait for all scripts to load
            window.addEventListener('load', () => {
                setTimeout(runDiagnostics, 1000);
            });

            // Also listen for saasTranslationsReady event
            document.addEventListener('saasTranslationsReady', (e) => {
                console.log('‚úÖ saasTranslationsReady event fired:', e.detail);
            });

        })();
    </script>
</body>
</html>
