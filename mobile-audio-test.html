<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹æœºéŸ³é¢‘æµ‹è¯•</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
            color: #fff;
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
        }
        button {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin: 10px 0;
        }
        .result {
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 14px;
        }
        .success { background: rgba(76, 175, 80, 0.3); border-left: 4px solid #4CAF50; }
        .error { background: rgba(244, 67, 54, 0.3); border-left: 4px solid #f44336; }
        .testing { background: rgba(33, 150, 243, 0.3); border-left: 4px solid #2196F3; }
        .url-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 4px;
            font-size: 11px;
            word-break: break-all;
            margin-top: 5px;
        }
        #progress {
            text-align: center;
            font-size: 16px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin: 10px 0;
        }
        .recommendation {
            background: rgba(255, 193, 7, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #FFC107;
        }
        .recommendation h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ è‡ªåŠ¨éŸ³é¢‘æµ‹è¯•</h1>

        <div class="card">
            <h2 style="margin-bottom: 15px; font-size: 18px;">ä¸€é”®æµ‹è¯•æ‰€æœ‰å¯èƒ½çš„URL</h2>
            <button onclick="startAutoTest()" id="testBtn">ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•</button>
            <div id="progress" style="display: none;">æ­£åœ¨æµ‹è¯•...</div>
        </div>

        <div class="card">
            <h2 style="margin-bottom: 15px; font-size: 18px;">æµ‹è¯•ç»“æœ</h2>
            <div id="results">ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•</div>
        </div>

        <div id="recommendation" style="display: none;"></div>
    </div>

    <script>
        let testResults = [];

        async function startAutoTest() {
            const btn = document.getElementById('testBtn');
            const progress = document.getElementById('progress');
            const resultsDiv = document.getElementById('results');

            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';
            progress.style.display = 'block';
            resultsDiv.innerHTML = '';
            testResults = [];

            // æµ‹è¯•URLåˆ—è¡¨
            const tests = [
                {
                    name: 'æµ‹è¯•1: Archive.orgé›†åˆï¼ˆè‹±æ–‡æ–‡ä»¶åï¼‰',
                    url: 'https://archive.org/download/sound-healing-collection/animal-sounds/SPAéŸ³ä¹ç–—é¦† 1 - å‡å‹ç–—ç¨‹ The Curing Shop - For Decompression.mp3'
                },
                {
                    name: 'æµ‹è¯•2: Archive.orgé›†åˆï¼ˆä¸­æ–‡åŸå§‹æ–‡ä»¶åï¼‰',
                    url: 'https://archive.org/download/sound-healing-collection/animal-sounds/æ£®æ—é‡Œç™¾çµé¸Ÿé¸£å«.mp3'
                },
                {
                    name: 'æµ‹è¯•3: Archive.orgé›†åˆï¼ˆURLç¼–ç æ–‡ä»¶åï¼‰',
                    url: 'https://archive.org/download/sound-healing-collection/animal-sounds/%E6%A3%AE%E6%9E%97%E9%87%8C%E7%99%BE%E7%81%B5%E9%B8%9F%E9%B8%A3%E5%8F%AB.mp3'
                },
                {
                    name: 'æµ‹è¯•4: ç®€åŒ–æ–‡ä»¶å¤¹åï¼ˆanimal-soundsï¼‰',
                    url: 'https://archive.org/download/sound-healing-collection/animal-sounds/æ£®æ—é‡Œç™¾çµé¸Ÿé¸£å«.mp3'
                },
                {
                    name: 'æµ‹è¯•5: å®Œæ•´æ–‡ä»¶å¤¹åï¼ˆAnimal soundsï¼‰',
                    url: 'https://archive.org/download/sound-healing-collection/Animal sounds/æ£®æ—é‡Œç™¾çµé¸Ÿé¸£å«.mp3'
                },
                {
                    name: 'æµ‹è¯•6: ä¸åŒé›†åˆåï¼ˆsound-healingï¼‰',
                    url: 'https://archive.org/download/sound-healing/animal-sounds/æ£®æ—é‡Œç™¾çµé¸Ÿé¸£å«.mp3'
                }
            ];

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                progress.textContent = `æµ‹è¯• ${i + 1}/${tests.length}: ${test.name}`;

                const result = await testAudioUrl(test.name, test.url);
                testResults.push(result);
                displayResult(result);
            }

            progress.textContent = 'âœ… æµ‹è¯•å®Œæˆï¼';
            btn.textContent = 'ğŸ”„ é‡æ–°æµ‹è¯•';
            btn.disabled = false;

            showRecommendation();
        }

        function testAudioUrl(name, url) {
            return new Promise((resolve) => {
                const audio = new Audio();
                const timeout = setTimeout(() => {
                    audio.src = '';
                    resolve({
                        name: name,
                        url: url,
                        success: false,
                        error: 'è¶…æ—¶ï¼ˆ15ç§’ï¼‰'
                    });
                }, 15000);

                audio.addEventListener('canplay', () => {
                    clearTimeout(timeout);
                    audio.src = '';
                    resolve({
                        name: name,
                        url: url,
                        success: true,
                        error: null
                    });
                }, { once: true });

                audio.addEventListener('error', (e) => {
                    clearTimeout(timeout);
                    let errorMsg = 'æœªçŸ¥é”™è¯¯';
                    if (e.target.error) {
                        switch(e.target.error.code) {
                            case 1: errorMsg = 'ç”¨æˆ·ä¸­æ­¢'; break;
                            case 2: errorMsg = 'ç½‘ç»œé”™è¯¯'; break;
                            case 3: errorMsg = 'è§£ç é”™è¯¯'; break;
                            case 4: errorMsg = 'URLæ— æ•ˆæˆ–æ–‡ä»¶ä¸å­˜åœ¨ï¼ˆ404ï¼‰'; break;
                        }
                    }
                    audio.src = '';
                    resolve({
                        name: name,
                        url: url,
                        success: false,
                        error: errorMsg
                    });
                }, { once: true });

                audio.src = url;
            });
        }

        function displayResult(result) {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = result.success ? 'result success' : 'result error';

            resultDiv.innerHTML = `
                <div><strong>${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}</strong> - ${result.name}</div>
                ${result.error ? `<div style="margin-top: 5px; opacity: 0.9;">é”™è¯¯: ${result.error}</div>` : ''}
                <div class="url-box">${result.url}</div>
            `;

            resultsDiv.appendChild(resultDiv);
        }

        function showRecommendation() {
            const recDiv = document.getElementById('recommendation');
            const successCount = testResults.filter(r => r.success).length;

            let html = '<div class="recommendation">';
            html += '<h3>ğŸ“‹ åˆ†æç»“æœ</h3>';

            if (successCount === 0) {
                html += `
                    <p><strong>æ‰€æœ‰æµ‹è¯•éƒ½å¤±è´¥äº†ï¼</strong></p>
                    <p style="margin-top: 10px;">å¯èƒ½çš„åŸå› ï¼š</p>
                    <ol style="margin-left: 20px; margin-top: 5px;">
                        <li>Archive.orgé›†åˆ "sound-healing-collection" ä¸å­˜åœ¨</li>
                        <li>é›†åˆåç§°å·²æ›´æ”¹</li>
                        <li>é›†åˆè¢«è®¾ä¸ºç§æœ‰æˆ–åˆ é™¤</li>
                        <li>ç½‘ç»œè¿æ¥é—®é¢˜</li>
                    </ol>
                    <p style="margin-top: 10px;"><strong>å»ºè®®ï¼š</strong>ç™»å½•Archive.orgæ£€æŸ¥é›†åˆæ˜¯å¦å­˜åœ¨ï¼Œå¹¶ç¡®è®¤é›†åˆåç§°ã€‚</p>
                `;
            } else {
                const successfulTests = testResults.filter(r => r.success);
                html += `<p><strong>æ‰¾åˆ° ${successCount} ä¸ªå¯ç”¨çš„URLæ ¼å¼ï¼</strong></p>`;
                html += '<p style="margin-top: 10px;">æˆåŠŸçš„æµ‹è¯•ï¼š</p>';
                html += '<ul style="margin-left: 20px; margin-top: 5px;">';
                successfulTests.forEach(test => {
                    html += `<li>${test.name}</li>`;
                });
                html += '</ul>';

                // æ ¹æ®æˆåŠŸçš„æµ‹è¯•ç»™å‡ºé…ç½®å»ºè®®
                const firstSuccess = successfulTests[0];
                html += '<p style="margin-top: 10px;"><strong>ä¿®å¤å»ºè®®ï¼š</strong></p>';
                html += '<p style="margin-top: 5px;">æ ¹æ®æµ‹è¯•ç»“æœï¼Œä½ çš„ä»£ç åº”è¯¥ä½¿ç”¨ä»¥ä¸‹URLæ ¼å¼ï¼š</p>';
                html += `<div class="url-box" style="margin-top: 5px;">${firstSuccess.url}</div>`;

                if (firstSuccess.url.includes('%E6%A3')) {
                    html += '<p style="margin-top: 10px;">âœ“ éœ€è¦ä½¿ç”¨ <strong>encodeURIComponent</strong> ç¼–ç ä¸­æ–‡æ–‡ä»¶å</p>';
                } else {
                    html += '<p style="margin-top: 10px;">âœ“ ä½¿ç”¨ <strong>åŸå§‹ä¸­æ–‡æ–‡ä»¶å</strong>ï¼ˆä¸ç¼–ç ï¼‰</p>';
                }
            }

            html += '</div>';
            recDiv.innerHTML = html;
            recDiv.style.display = 'block';
        }
    </script>
</body>
</html>
