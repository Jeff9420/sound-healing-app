<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3Dè½®æ’­æµ‹è¯• - å£°éŸ³ç–—æ„ˆåº”ç”¨</title>
    <link rel="stylesheet" href="sound-healing-app/assets/css/main.css">
    <link rel="stylesheet" href="sound-healing-app/assets/css/playlist.css">
    <style>
        body {
            background: linear-gradient(135deg, #1a2e1a, #2d4a2d);
            color: #f7f4e9;
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .test-button {
            background: rgba(127, 176, 105, 0.6);
            border: 2px solid rgba(127, 176, 105, 0.8);
            color: #f7f4e9;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            background: rgba(127, 176, 105, 0.8);
            transform: translateY(-2px);
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-ok {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }

        .status-error {
            background: rgba(244, 67, 54, 0.3);
            color: #F44336;
        }

        .status-loading {
            background: rgba(255, 193, 7, 0.3);
            color: #FFC107;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ  3Dè½®æ’­æµ‹è¯•é¡µé¢</h1>
        <p>æµ‹è¯•å£°éŸ³ç–—æ„ˆåº”ç”¨çš„3Dæ—‹è½¬è½®æ’­åŠŸèƒ½</p>
    </div>

    <div class="test-info">
        <h3>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h3>
        <ul>
            <li>âœ… 3Dè½®æ’­å®¹å™¨æ˜¯å¦æ­£ç¡®æ¸²æŸ“</li>
            <li>âœ… 9ä¸ªéŸ³é¢‘åˆ†ç±»å¡ç‰‡æ˜¯å¦æ­£ç¡®ç”Ÿæˆ</li>
            <li>âœ… 3Dæ—‹è½¬åŠ¨ç”»æ˜¯å¦æµç•…</li>
            <li>âœ… è½®æ’­æ§åˆ¶æŒ‰é’®æ˜¯å¦å“åº”</li>
            <li>âœ… é¼ æ ‡æ‹–æ‹½æ§åˆ¶æ˜¯å¦å·¥ä½œ</li>
            <li>âœ… é”®ç›˜å¿«æ·é”®æ˜¯å¦å·¥ä½œ</li>
            <li>âœ… è‡ªåŠ¨æ—‹è½¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
            <li>âœ… å¡ç‰‡ç‚¹å‡»æ˜¯å¦è§¦å‘æ’­æ”¾åˆ—è¡¨</li>
        </ul>
    </div>

    <!-- 3Då£°éŸ³è½®æ’­ -->
    <div class="audio-carousel-container">
        <div class="audio-carousel" id="audioCarousel">
            <div class="carousel-inner" id="categoriesContainer">
                <!-- éŸ³é¢‘åˆ†ç±»å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆä¸º3Dè½®æ’­å¡ç‰‡ -->
            </div>
        </div>

        <!-- è½®æ’­æ§åˆ¶å™¨ -->
        <div class="carousel-controls">
            <button class="carousel-btn prev-btn" id="carouselPrev" aria-label="ä¸Šä¸€ä¸ªåˆ†ç±»">â€¹</button>
            <button class="carousel-btn auto-btn" id="carouselAuto" aria-label="è‡ªåŠ¨è½®æ’­">â¯</button>
            <button class="carousel-btn next-btn" id="carouselNext" aria-label="ä¸‹ä¸€ä¸ªåˆ†ç±»">â€º</button>
        </div>

        <!-- åˆ†ç±»æŒ‡ç¤ºå™¨ -->
        <div class="carousel-indicators" id="carouselIndicators">
            <!-- å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <div class="controls-panel">
        <h3>ğŸ® æµ‹è¯•æ§åˆ¶</h3>
        <button class="test-button" onclick="testCarouselCreation()">åˆ›å»ºè½®æ’­å¡ç‰‡</button>
        <button class="test-button" onclick="testRotateNext()">å‘å‰æ—‹è½¬</button>
        <button class="test-button" onclick="testRotatePrev()">å‘åæ—‹è½¬</button>
        <button class="test-button" onclick="testAutoRotate()">åˆ‡æ¢è‡ªåŠ¨æ—‹è½¬</button>
        <button class="test-button" onclick="testRandomJump()">éšæœºè·³è½¬</button>

        <div style="margin-top: 20px;">
            <h4>ğŸ“Š çŠ¶æ€ç›‘æ§</h4>
            <div>
                éŸ³é¢‘é…ç½®: <span id="configStatus" class="status-indicator status-loading">æ£€æŸ¥ä¸­...</span>
            </div>
            <div>
                3Dè½®æ’­ç®¡ç†å™¨: <span id="carouselStatus" class="status-indicator status-loading">æ£€æŸ¥ä¸­...</span>
            </div>
            <div>
                è½®æ’­å¡ç‰‡æ•°é‡: <span id="cardCount">0</span>
            </div>
            <div>
                å½“å‰ç´¢å¼•: <span id="currentIndex">0</span>
            </div>
            <div>
                å½“å‰è§’åº¦: <span id="currentAngle">0Â°</span>
            </div>
        </div>

        <div style="margin-top: 20px;">
            <h4>âŒ¨ï¸ å¿«æ·é”®è¯´æ˜</h4>
            <ul style="font-size: 14px;">
                <li>â†/â†’ æ–¹å‘é”®ï¼šæ‰‹åŠ¨æ—‹è½¬è½®æ’­</li>
                <li>ç©ºæ ¼é”®ï¼šåˆ‡æ¢è‡ªåŠ¨æ—‹è½¬</li>
                <li>ESCé”®ï¼šåœæ­¢è‡ªåŠ¨æ—‹è½¬</li>
                <li>é¼ æ ‡æ‹–æ‹½ï¼šæ‰‹åŠ¨æ§åˆ¶æ—‹è½¬</li>
            </ul>
        </div>
    </div>

    <!-- åŠ è½½å¿…è¦çš„è„šæœ¬ -->
    <script src="sound-healing-app/assets/js/audio-config.js"></script>
    <script src="sound-healing-app/assets/js/audio-carousel-3d.js"></script>

    <script>
        // æµ‹è¯•çŠ¶æ€ç›‘æ§
        let testMonitor = {
            configLoaded: false,
            carouselLoaded: false,

            checkStatus() {
                // æ£€æŸ¥éŸ³é¢‘é…ç½®
                if (typeof AUDIO_CONFIG !== 'undefined') {
                    document.getElementById('configStatus').textContent = 'å·²åŠ è½½';
                    document.getElementById('configStatus').className = 'status-indicator status-ok';
                    this.configLoaded = true;
                } else {
                    document.getElementById('configStatus').textContent = 'æœªåŠ è½½';
                    document.getElementById('configStatus').className = 'status-indicator status-error';
                }

                // æ£€æŸ¥3Dè½®æ’­ç®¡ç†å™¨
                if (window.audioCarousel3D) {
                    document.getElementById('carouselStatus').textContent = 'å·²åˆå§‹åŒ–';
                    document.getElementById('carouselStatus').className = 'status-indicator status-ok';
                    this.carouselLoaded = true;

                    // æ›´æ–°çŠ¶æ€ä¿¡æ¯
                    const carousel = window.audioCarousel3D;
                    document.getElementById('currentIndex').textContent = carousel.currentIndex;
                    document.getElementById('currentAngle').textContent = carousel.currentAngle + 'Â°';

                    // è®¡ç®—å¡ç‰‡æ•°é‡
                    const cards = document.querySelectorAll('#categoriesContainer .ecosystem-card');
                    document.getElementById('cardCount').textContent = cards.length;
                } else {
                    document.getElementById('carouselStatus').textContent = 'æœªåˆå§‹åŒ–';
                    document.getElementById('carouselStatus').className = 'status-indicator status-error';
                }
            },

            startMonitoring() {
                setInterval(() => this.checkStatus(), 1000);
            }
        };

        // æµ‹è¯•å‡½æ•°
        function testCarouselCreation() {
            console.log('ğŸ§ª æµ‹è¯•ï¼šåˆ›å»ºè½®æ’­å¡ç‰‡');

            if (typeof forceCreateEcosystemCards3D === 'function') {
                forceCreateEcosystemCards3D();
                console.log('âœ… 3Dè½®æ’­å¡ç‰‡åˆ›å»ºå‡½æ•°å·²è°ƒç”¨');
            } else if (window.audioCarousel3D) {
                window.audioCarousel3D.createCarouselCards();
                console.log('âœ… é€šè¿‡è½®æ’­å®ä¾‹åˆ›å»ºå¡ç‰‡');
            } else {
                console.error('âŒ è½®æ’­åŠŸèƒ½æœªå°±ç»ª');
                alert('âŒ è½®æ’­åŠŸèƒ½æœªå°±ç»ªï¼Œè¯·æ£€æŸ¥è„šæœ¬åŠ è½½');
            }
        }

        function testRotateNext() {
            console.log('ğŸ§ª æµ‹è¯•ï¼šå‘å‰æ—‹è½¬');
            if (window.audioCarousel3D) {
                window.audioCarousel3D.nextCategory();
                console.log('âœ… å‘å‰æ—‹è½¬æ‰§è¡Œå®Œæˆ');
            } else {
                console.error('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
                alert('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
            }
        }

        function testRotatePrev() {
            console.log('ğŸ§ª æµ‹è¯•ï¼šå‘åæ—‹è½¬');
            if (window.audioCarousel3D) {
                window.audioCarousel3D.previousCategory();
                console.log('âœ… å‘åæ—‹è½¬æ‰§è¡Œå®Œæˆ');
            } else {
                console.error('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
                alert('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
            }
        }

        function testAutoRotate() {
            console.log('ğŸ§ª æµ‹è¯•ï¼šåˆ‡æ¢è‡ªåŠ¨æ—‹è½¬');
            if (window.audioCarousel3D) {
                window.audioCarousel3D.toggleAutoRotate();
                const status = window.audioCarousel3D.autoRotateActive ? 'å·²å¯åŠ¨' : 'å·²åœæ­¢';
                console.log(`âœ… è‡ªåŠ¨æ—‹è½¬ ${status}`);
                alert(`ğŸ  è‡ªåŠ¨æ—‹è½¬ ${status}`);
            } else {
                console.error('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
                alert('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
            }
        }

        function testRandomJump() {
            console.log('ğŸ§ª æµ‹è¯•ï¼šéšæœºè·³è½¬');
            if (window.audioCarousel3D) {
                const randomIndex = Math.floor(Math.random() * 9);
                window.audioCarousel3D.goToCategory(randomIndex);
                console.log(`âœ… è·³è½¬åˆ°åˆ†ç±» ${randomIndex}`);
                alert(`ğŸ¯ å·²è·³è½¬åˆ°åˆ†ç±» ${randomIndex}`);
            } else {
                console.error('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
                alert('âŒ è½®æ’­å®ä¾‹æœªæ‰¾åˆ°');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ“„ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');

            // å¼€å§‹çŠ¶æ€ç›‘æ§
            testMonitor.startMonitoring();

            // å»¶è¿Ÿæ‰§è¡Œåˆå§‹æµ‹è¯•
            setTimeout(() => {
                console.log('ğŸ”„ å¼€å§‹åˆå§‹åŒ–æµ‹è¯•...');
                testMonitor.checkStatus();

                // å¦‚æœé…ç½®å’Œè½®æ’­éƒ½å°±ç»ªï¼Œè‡ªåŠ¨åˆ›å»ºå¡ç‰‡
                if (testMonitor.configLoaded && testMonitor.carouselLoaded) {
                    console.log('âœ… è‡ªåŠ¨åˆ›å»º3Dè½®æ’­å¡ç‰‡');
                    testCarouselCreation();
                }
            }, 2000);

            // æ·»åŠ é¢å¤–çš„æ£€æŸ¥å’Œé‡è¯•é€»è¾‘
            let retryCount = 0;
            const maxRetries = 10;

            const retryInit = () => {
                if (retryCount >= maxRetries) {
                    console.warn('âš ï¸ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œåœæ­¢é‡è¯•');
                    return;
                }

                testMonitor.checkStatus();

                if (!testMonitor.configLoaded || !testMonitor.carouselLoaded) {
                    retryCount++;
                    console.log(`ğŸ”„ é‡è¯•åˆå§‹åŒ– (${retryCount}/${maxRetries})`);
                    setTimeout(retryInit, 1000);
                } else {
                    console.log('âœ… åˆå§‹åŒ–æˆåŠŸï¼Œåˆ›å»ºè½®æ’­å¡ç‰‡');
                    testCarouselCreation();
                }
            };

            setTimeout(retryInit, 3000);
        });

        // æ·»åŠ æ€§èƒ½ç›‘æ§
        let performanceMonitor = {
            startTime: Date.now(),

            logTiming(event) {
                const elapsed = Date.now() - this.startTime;
                console.log(`â±ï¸ æ€§èƒ½ï¼š${event} - ${elapsed}ms`);
            }
        };

        // ç›‘æ§è½®æ’­æ€§èƒ½
        if (window.audioCarousel3D) {
            const originalUpdate = window.audioCarousel3D.updateCarousel;
            window.audioCarousel3D.updateCarousel = function() {
                const start = performance.now();
                originalUpdate.call(this);
                const end = performance.now();
                console.log(`âš¡ è½®æ’­æ›´æ–°è€—æ—¶: ${(end - start).toFixed(2)}ms`);
            };
        }

        console.log('ğŸš€ 3Dè½®æ’­æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>