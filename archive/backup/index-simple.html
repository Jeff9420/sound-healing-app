<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å£°éŸ³ç–—æ„ˆç©ºé—´ - ä¸“ä¸šéŸ³é¢‘ç–—æ³•å¹³å° | Sound Healing Space</title>

    <!-- Website Icons -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY2NkZGO3N0b3Atb3BhY2l0eToxIiAvPgo8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRjY2OTk7c3RvcC1vcGFjaXR5OjEiIC8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPGVSBGF0aCBkPSJNMTYgNEMxOC43NjE0IDQgMjEgNi4yMzg2IDIxIDlWMjNDMjEgMjUuNzYxNCAxOC43NjE0IDI4IDE2IDI4QzEzLjIzODYgMjggMTEgMjUuNzYxNCAxMSAyM1Y5QzExIDYuMjM4NiAxMy4yMzg2IDQgMTYgNFoiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjMiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjEwIiBjeT0iMTAiIHI9IjIiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjciLz4KPGNpcmNsZSBjeD0iMjIiIGN5PSIyMiIgcj0iMiIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuNyIvPgo8L3N2Zz4K">

    <!-- SEO Meta Tags -->
    <meta name="description" content="å£°éŸ³ç–—æ„ˆç©ºé—´ - ä¸“ä¸šéŸ³é¢‘ç–—æ³•å¹³å°ï¼Œæä¾›213+ç§ç–—æ„ˆéŸ³é¢‘ï¼ŒåŒ…æ‹¬è‡ªç„¶å£°éŸ³ã€å†¥æƒ³éŸ³ä¹ã€é¢‚é’µç–—æ„ˆç­‰ã€‚å¸®åŠ©æ‚¨æ”¾æ¾èº«å¿ƒï¼Œæ”¹å–„ç¡çœ ï¼Œå‡è½»å‹åŠ›ã€‚">
    <meta name="keywords" content="å£°éŸ³ç–—æ„ˆ,éŸ³é¢‘ç–—æ³•,å†¥æƒ³éŸ³ä¹,åŠ©çœ éŸ³ä¹,æ”¾æ¾éŸ³ä¹,è‡ªç„¶å£°éŸ³,é¢‚é’µç–—æ„ˆ,å‡å‹éŸ³ä¹,ä¸“æ³¨éŸ³ä¹,èº«å¿ƒå¥åº·">
    <meta name="author" content="Sound Healing Space">

    <!-- Security: Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://archive.org https://www.googletagmanager.com https://www.google-analytics.com https://www.clarity.ms; style-src 'self' 'unsafe-inline' https://archive.org; media-src 'self' https: data:; connect-src 'self' https://archive.org; img-src 'self' data: https:;">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/mobile-optimization.css">
    <link rel="stylesheet" href="assets/css/touch-target-optimization.css">
    <link rel="stylesheet" href="assets/css/color-contrast-enhancement.css">

    <!-- Critical CSS Inlined -->
    <style>
        /* Critical CSS for loading */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: center;
        }

        /* Main app container */
        #app {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            ğŸµ æ­£åœ¨åŠ è½½å£°éŸ³ç–—æ„ˆç©ºé—´...<br>
            <small style="opacity: 0.8;">è¯·ç¨å€™</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app">
        <!-- Header -->
        <header style="padding: 20px; text-align: center; color: white;">
            <h1 style="margin: 0; font-size: 2.5em;">ğŸµ å£°éŸ³ç–—æ„ˆç©ºé—´</h1>
            <p style="margin: 10px 0; opacity: 0.9;">ä¸“ä¸šéŸ³é¢‘ç–—æ³•å¹³å° - 213+ç§ç–—æ„ˆéŸ³é¢‘</p>
        </header>

        <!-- Main Content Area -->
        <main style="padding: 20px; max-width: 1200px; margin: 0 auto;">
            <!-- Category Selection -->
            <section id="categorySection" style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                <h2 style="color: white; text-align: center; margin-bottom: 30px;">é€‰æ‹©ç–—æ„ˆç±»åˆ«</h2>
                <div id="categoryGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <!-- Categories will be loaded here -->
                </div>
            </section>

            <!-- Playlist Section -->
            <section id="playlistSection" style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 30px; margin-bottom: 30px; display: none;">
                <h2 id="playlistTitle" style="color: white; margin-bottom: 20px;"></h2>
                <div id="playlistContainer" style="max-height: 400px; overflow-y: auto;">
                    <!-- Tracks will be loaded here -->
                </div>
                <button onclick="backToCategories()" style="margin-top: 20px; background: rgba(255,255,255,0.2); color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer;">â† è¿”å›ç±»åˆ«</button>
            </section>

            <!-- Audio Player -->
            <section id="playerSection" style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 30px; position: fixed; bottom: 20px; left: 20px; right: 20px; backdrop-filter: blur(10px);">
                <div id="nowPlaying" style="color: white; margin-bottom: 15px;">
                    <strong id="trackName">æœªæ’­æ”¾</strong>
                </div>
                <audio id="audioPlayer" controls style="width: 100%;"></audio>
                <div style="margin-top: 15px; text-align: center;">
                    <button onclick="togglePlayPause()" style="background: #FF6699; color: white; border: none; padding: 10px 20px; border-radius: 25px; margin: 0 10px; cursor: pointer;">æ’­æ”¾/æš‚åœ</button>
                    <button onclick="stopAudio()" style="background: #6666FF; color: white; border: none; padding: 10px 20px; border-radius: 25px; margin: 0 10px; cursor: pointer;">åœæ­¢</button>
                </div>
            </section>
        </main>

        <!-- Background Canvas -->
        <canvas id="backgroundCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.3;"></canvas>
    </div>

    <!-- Security Modules (must load first) -->
    <script src="assets/js/security-utils.js"></script>
    <script src="assets/js/csrf-protection.js"></script>

    <!-- Core Application -->
    <script src="assets/js/audio-config.js"></script>
    <script src="assets/js/app.js"></script>

    <!-- UI Components -->
    <script src="assets/js/ui-controller.js"></script>
    <script src="assets/js/playlist-ui.js"></script>
    <script src="assets/js/audio-manager.js"></script>

    <!-- Background Scenes -->
    <script src="assets/js/background-scene-manager.js"></script>

    <!-- Security & Accessibility Features -->
    <script src="assets/js/aria-optimizer.js" defer></script>
    <script src="assets/js/sri-manager.js" defer></script>
    <script src="assets/js/gdpr-manager.js" defer></script>

    <script>
        // Simple app initialization
        let currentCategory = null;
        let audioPlayer = document.getElementById('audioPlayer');

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('app').style.display = 'block';

                // Load categories
                loadCategories();

                // Initialize background animation
                initBackgroundAnimation();
            }, 1000);
        });

        function loadCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            const categories = window.AUDIO_CONFIG ? Object.keys(window.AUDIO_CONFIG) : [];

            if (categories.length === 0) {
                // Fallback categories if config not loaded
                const fallbackCategories = [
                    { key: 'meditation', name: 'å†¥æƒ³éŸ³ä¹', icon: 'ğŸ§˜' },
                    { key: 'nature', name: 'è‡ªç„¶å£°éŸ³', icon: 'ğŸŒ¿' },
                    { key: 'rain', name: 'é›¨å£°', icon: 'ğŸŒ§ï¸' },
                    { key: 'singing', name: 'é¢‚é’µ', icon: 'ğŸ•¯ï¸' }
                ];

                fallbackCategories.forEach(cat => {
                    const categoryEl = createCategoryElement(cat);
                    categoryGrid.appendChild(categoryEl);
                });
            } else {
                categories.forEach(categoryKey => {
                    const category = {
                        key: categoryKey,
                        name: window.AUDIO_CONFIG[categoryKey].displayName || categoryKey,
                        icon: getCategoryIcon(categoryKey)
                    };
                    const categoryEl = createCategoryElement(category);
                    categoryGrid.appendChild(categoryEl);
                });
            }
        }

        function createCategoryElement(category) {
            const div = document.createElement('div');
            div.className = 'category-card';
            div.style.cssText = `
                background: rgba(255,255,255,0.2);
                border-radius: 15px;
                padding: 30px;
                text-align: center;
                cursor: pointer;
                transition: all 0.3s ease;
                color: white;
            `;

            div.innerHTML = `
                <div style="font-size: 3em; margin-bottom: 15px;">${category.icon}</div>
                <h3 style="margin: 0; font-size: 1.2em;">${category.name}</h3>
            `;

            div.onclick = () => openCategory(category);

            div.onmouseover = () => {
                div.style.transform = 'scale(1.05)';
                div.style.background = 'rgba(255,255,255,0.3)';
            };

            div.onmouseout = () => {
                div.style.transform = 'scale(1)';
                div.style.background = 'rgba(255,255,255,0.2)';
            };

            return div;
        }

        function getCategoryIcon(category) {
            const icons = {
                'Animal sounds': 'ğŸ¦',
                'Chakra': 'ğŸ•‰ï¸',
                'Fire': 'ğŸ”¥',
                'hypnosis': 'ğŸŒ€',
                'meditation': 'ğŸ§˜',
                'Rain': 'ğŸŒ§ï¸',
                'running water': 'ğŸ’§',
                'Singing bowl sound': 'ğŸ•¯ï¸',
                'Subconscious Therapy': 'ğŸŒ™'
            };
            return icons[category] || 'ğŸµ';
        }

        function openCategory(category) {
            currentCategory = category;
            document.getElementById('categorySection').style.display = 'none';
            document.getElementById('playlistSection').style.display = 'block';
            document.getElementById('playlistTitle').textContent = category.name;

            // Load tracks for this category
            loadTracks(category);
        }

        function loadTracks(category) {
            const container = document.getElementById('playlistContainer');
            container.innerHTML = '';

            if (window.AUDIO_CONFIG && window.AUDIO_CONFIG[category.key]) {
                const tracks = window.AUDIO_CONFIG[category.key].tracks || [];

                if (tracks.length === 0) {
                    container.innerHTML = '<p style="color: white; text-align: center;">è¯¥ç±»åˆ«æš‚æ— éŸ³é¢‘æ–‡ä»¶</p>';
                    return;
                }

                tracks.forEach((track, index) => {
                    const trackEl = document.createElement('div');
                    trackEl.className = 'track-item';
                    trackEl.style.cssText = `
                        background: rgba(255,255,255,0.1);
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 10px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        color: white;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    `;

                    trackEl.innerHTML = `
                        <span style="font-size: 1.5em;">ğŸµ</span>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">${track.name || track.fileName}</div>
                            <div style="font-size: 0.9em; opacity: 0.8;">${formatDuration(track.duration || 0)}</div>
                        </div>
                    `;

                    trackEl.onclick = () => playTrack(track, category);

                    trackEl.onmouseover = () => {
                        trackEl.style.background = 'rgba(255,255,255,0.2)';
                    };

                    trackEl.onmouseout = () => {
                        trackEl.style.background = 'rgba(255,255,255,0.1)';
                    };

                    container.appendChild(trackEl);
                });
            } else {
                // Fallback tracks
                const fallbackTracks = [
                    { name: 'æ·±åº¦å†¥æƒ³', duration: 600, fileName: 'meditation1.mp3' },
                    { name: 'æ”¾æ¾ç»ƒä¹ ', duration: 300, fileName: 'meditation2.mp3' }
                ];

                fallbackTracks.forEach(track => {
                    const trackEl = document.createElement('div');
                    trackEl.className = 'track-item';
                    trackEl.style.cssText = `
                        background: rgba(255,255,255,0.1);
                        border-radius: 10px;
                        padding: 15px;
                        margin-bottom: 10px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        color: white;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    `;

                    trackEl.innerHTML = `
                        <span style="font-size: 1.5em;">ğŸµ</span>
                        <div style="flex: 1;">
                            <div style="font-weight: bold;">${track.name}</div>
                            <div style="font-size: 0.9em; opacity: 0.8;">${formatDuration(track.duration)}</div>
                        </div>
                    `;

                    trackEl.onclick = () => playTrack(track, category);

                    container.appendChild(trackEl);
                });
            }
        }

        function playTrack(track, category) {
            const trackName = document.getElementById('trackName');
            trackName.textContent = track.name || track.fileName;

            // Try to load the audio file
            let audioUrl = '';
            if (category.key && track.fileName) {
                audioUrl = `assets/audio/${category.key}/${track.fileName}`;
            } else {
                // Use placeholder audio from archive.org
                audioUrl = 'https://archive.org/download/sound-healing-collection/meditation/Deep%20Meditation.mp3';
            }

            audioPlayer.src = audioUrl;
            audioPlayer.play().catch(e => {
                console.log('Auto-play failed:', e);
                showNotification('è¯·ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹æ’­æ”¾');
            });
        }

        function togglePlayPause() {
            if (audioPlayer.paused) {
                audioPlayer.play();
            } else {
                audioPlayer.pause();
            }
        }

        function stopAudio() {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
        }

        function backToCategories() {
            document.getElementById('playlistSection').style.display = 'none';
            document.getElementById('categorySection').style.display = 'block';
            stopAudio();
        }

        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 10000;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function initBackgroundAnimation() {
            const canvas = document.getElementById('backgroundCanvas');
            const ctx = canvas.getContext('2d');

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    radius: Math.random() * 3 + 1,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    opacity: Math.random() * 0.5 + 0.2
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                particles.forEach(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;

                    if (particle.x < 0 || particle.x > canvas.width) particle.vx *= -1;
                    if (particle.y < 0 || particle.y > canvas.height) particle.vy *= -1;

                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${particle.opacity})`;
                    ctx.fill();
                });

                requestAnimationFrame(animate);
            }

            animate();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }
    </script>
</body>
</html>