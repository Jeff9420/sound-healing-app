<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>声音疗愈空间 - 专业音频疗法平台 | Sound Healing Space</title>

    <!-- Website Icons -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY2NkZGO3N0b3Atb3BhY2l0eToxIiAvPgo8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRjY2OTk7c3RvcC1vcGFjaXR5OjEiIC8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPGV2ZyBwYXRoPSJNMTYgNEMxOC43NjE0IDQgMjEgNi4yMzg2IDIxIDlWMjNDMjEgMjUuNzYxNCAxOC43NjE0IDI4IDE2IDI4QzEzLjIzODYgMjggMTEgMjUuNzYxNCAxMSAyM1Y5QzExIDYuMjM4NiAxMy4yMzg2IDQgMTYgNFoiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjMiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjEwIiBjeT0iMTAiIHI9IjIiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjciLz4KPGNpcmNsZSBjeD0iMjIiIGN5PSIyMiIgcj0iMiIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuNyIvPgo8L3N2Zz4K">

    <!-- SEO Meta Tags -->
    <meta name="description" content="声音疗愈空间 - 专业音频疗法平台，提供221+种疗愈音频，包括自然声音、冥想音乐、颂钵疗愈等。帮助您放松身心，改善睡眠，减轻压力。">
    <meta name="keywords" content="声音疗愈,音频疗法,冥想音乐,助眠音乐,放松音乐,自然声音,颂钵疗愈,减压音乐,专注音乐,身心健康">
    <meta name="author" content="Sound Healing Space">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            background: #1a1a1a;
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: center;
        }

        /* Main App */
        #app {
            display: none;
            min-height: 100vh;
            position: relative;
        }

        /* Header */
        .header {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            position: relative;
            z-index: 100;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
        }

        /* Category Grid */
        .category-section {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .category-card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .category-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .category-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .category-name {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .category-desc {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .category-count {
            font-size: 0.8em;
            opacity: 0.5;
        }

        /* Playlist Modal */
        .playlist-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .playlist-content {
            position: relative;
            background: linear-gradient(135deg, rgba(102,102,255,0.9) 0%, rgba(255,102,153,0.9) 100%);
            margin: 50px auto;
            padding: 30px;
            width: 90%;
            max-width: 700px;
            border-radius: 25px;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .playlist-title {
            font-size: 1.8em;
            font-weight: bold;
        }

        .close-btn {
            font-size: 2em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .close-btn:hover {
            transform: scale(1.2);
        }

        .track-list {
            display: grid;
            gap: 15px;
        }

        .track-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .track-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(10px);
        }

        .track-icon {
            font-size: 2em;
        }

        .track-info {
            flex: 1;
        }

        .track-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .track-duration {
            font-size: 0.9em;
            opacity: 0.7;
        }

        /* Audio Player */
        .audio-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            padding: 25px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 500;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .audio-player.show {
            transform: translateY(0);
        }

        .audio-player.minimized {
            transform: translateY(calc(100% - 60px));
            cursor: pointer;
        }

        .audio-player.minimized .player-content {
            display: none;
        }

        .minimized-display {
            position: absolute;
            bottom: 10px;
            left: 20px;
            right: 60px;
            display: none;
        }

        .audio-player.minimized .minimized-display {
            display: block;
        }

        .minimized-text {
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .minimize-indicator {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 0.8em;
            opacity: 0.7;
            cursor: pointer;
            padding: 5px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            transition: all 0.2s;
            display: none;
        }

        .audio-player.show .minimize-indicator {
            display: block;
            z-index: 10;
        }

        .minimize-indicator:hover {
            opacity: 1;
            background: rgba(255,255,255,0.2);
        }

        .player-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .now-playing {
            text-align: center;
            margin-bottom: 10px;
        }

        .track-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .track-category {
            font-size: 0.9em;
            opacity: 0.7;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }

        .play-btn {
            font-size: 2.5em;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            padding: 15px;
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s;
        }

        .time-display {
            font-size: 0.9em;
            opacity: 0.7;
            min-width: 45px;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .extra-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            margin-top: 10px;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speed-label {
            font-size: 0.9em;
            opacity: 0.7;
        }

        .speed-options {
            display: flex;
            gap: 5px;
        }

        .speed-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .speed-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .speed-btn.active {
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border-color: transparent;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
        }

        .volume-fill {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 70%;
        }

        /* Controls Bar */
        .controls-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 200;
        }

        .control-icon {
            width: 45px;
            height: 45px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2em;
        }

        .control-icon:hover {
            background: rgba(0,0,0,0.7);
            transform: scale(1.1);
        }

        /* Sleep Timer */
        .timer-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            z-index: 1500;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .timer-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .timer-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .timer-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .timer-btn.cancel-btn {
            background: rgba(255, 59, 48, 0.2);
            border-color: rgba(255, 59, 48, 0.4);
        }

        .timer-btn.cancel-btn:hover {
            background: rgba(255, 59, 48, 0.3);
        }

        .timer-btn.set-btn {
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border: none;
            font-weight: bold;
        }

        .timer-status {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .status-text {
            font-size: 0.9em;
            margin-bottom: 5px;
            opacity: 0.8;
        }

        .countdown-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #6666FF;
        }

        .timer-preset,
        .timer-custom,
        .timer-features {
            margin-bottom: 20px;
        }

        .timer-label {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.7;
        }

        .custom-input {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .custom-input input {
            width: 80px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            text-align: center;
            font-size: 1em;
        }

        .custom-input input:focus {
            outline: none;
            border-color: #6666FF;
            background: rgba(255,255,255,0.15);
        }

        .feature-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.9em;
            cursor: pointer;
            user-select: none;
        }

        .feature-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* History Modal */
        .history-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 15px;
            z-index: 1500;
            width: 90%;
            max-width: 500px;
            max-height: 70vh;
            color: white;
        }

        .history-content {
            max-height: 50vh;
            overflow-y: auto;
            margin: 20px 0;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .history-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .history-track-info {
            flex: 1;
        }

        .history-track-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .history-track-category {
            font-size: 0.85em;
            opacity: 0.7;
        }

        .history-track-time {
            font-size: 0.8em;
            opacity: 0.6;
        }

        .history-play-btn {
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: transform 0.2s;
        }

        .history-play-btn:hover {
            transform: scale(1.05);
        }

        .empty-history {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
        }

        .history-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .clear-history-btn {
            background: rgba(255, 59, 48, 0.2);
            border: 1px solid rgba(255, 59, 48, 0.4);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .clear-history-btn:hover {
            background: rgba(255, 59, 48, 0.3);
        }

        .close-history-btn {
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Background Canvas */
        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.6;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .notification.success {
            background: rgba(40, 167, 69, 0.9);
            border: 1px solid rgba(40, 167, 69, 1);
        }

        .notification.error {
            background: rgba(220, 53, 69, 0.9);
            border: 1px solid rgba(220, 53, 69, 1);
        }

        .notification.info {
            background: rgba(23, 162, 184, 0.9);
            border: 1px solid rgba(23, 162, 184, 1);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
                padding: 10px;
            }

            .category-card {
                padding: 15px;
            }

            .category-icon {
                font-size: 2.5em;
            }

            .category-name {
                font-size: 1.1em;
            }

            .category-desc {
                font-size: 0.8em;
            }

            .header h1 {
                font-size: 2em;
            }

            .subtitle {
                font-size: 1em;
            }

            .controls-bar {
                top: 10px;
                right: 10px;
                gap: 5px;
            }

            .control-icon {
                width: 35px;
                height: 35px;
                font-size: 0.9em;
            }

            .playlist-content {
                width: 95%;
                margin: 20px auto;
                padding: 20px;
            }

            .playlist-title {
                font-size: 1.5em;
            }

            .track-item {
                padding: 15px;
                gap: 15px;
            }

            .track-icon {
                font-size: 1.5em;
            }

            .player-controls {
                gap: 10px;
            }

            .control-btn {
                font-size: 1.5em;
                padding: 8px;
            }

            .play-btn {
                font-size: 2em;
                padding: 12px;
            }

            .track-title {
                font-size: 1em;
            }

            .track-category {
                font-size: 0.8em;
            }

            .progress-container {
                gap: 10px;
            }

            .time-display {
                font-size: 0.8em;
                min-width: 35px;
            }

            .volume-container {
                display: none;
            }

            .audio-player {
                padding: 15px;
            }

            .minimize-indicator {
                font-size: 0.7em;
                padding: 3px 8px;
            }

            .notification {
                width: 90%;
                max-width: 300px;
                padding: 12px 20px;
                font-size: 0.9em;
            }

            .timer-modal {
                width: 90%;
                margin: 30% auto;
                padding: 20px;
            }

            .timer-btn {
                padding: 10px 15px;
                font-size: 0.9em;
                margin: 5px;
            }

            .extra-controls {
                flex-direction: column;
                gap: 10px;
            }

            .speed-control {
                width: 100%;
                justify-content: center;
            }

            .speed-label {
                font-size: 0.8em;
            }

            .speed-options {
                flex-wrap: wrap;
                justify-content: center;
            }

            .speed-btn {
                padding: 4px 8px;
                font-size: 0.7em;
            }
        }

        /* Extra Small Screens */
        @media (max-width: 480px) {
            .category-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 8px;
            }

            .category-card {
                padding: 12px;
            }

            .category-icon {
                font-size: 2em;
            }

            .category-name {
                font-size: 1em;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .player-controls {
                gap: 8px;
            }

            .control-btn {
                font-size: 1.3em;
                padding: 6px;
            }

            .play-btn {
                font-size: 1.8em;
                padding: 10px;
            }
        }

        /* Favorites Modal Styles */
        .favorites-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 15px;
            z-index: 1500;
            width: 90%;
            max-width: 500px;
            max-height: 70vh;
            color: white;
        }

        .favorites-content {
            max-height: 50vh;
            overflow-y: auto;
            margin: 20px 0;
        }

        .favorites-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            transition: all 0.2s;
        }

        .favorites-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .favorites-info {
            flex: 1;
        }

        .favorites-name {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .favorites-category {
            font-size: 0.85em;
            opacity: 0.7;
        }

        .favorites-item-actions {
            display: flex;
            gap: 8px;
        }

        .favorites-play-btn {
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: transform 0.2s;
        }

        .favorites-play-btn:hover {
            transform: scale(1.05);
        }

        .favorites-remove-btn {
            background: none;
            border: none;
            color: #FF6B6B;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .favorites-remove-btn:hover {
            background: rgba(255,107,107,0.2);
        }

        .empty-favorites {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
        }

        .favorites-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .play-all-favorites-btn {
            background: #6666FF;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-all-favorites-btn:hover {
            background: #5555EE;
        }

        .clear-favorites-btn {
            background: #FF6B6B;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-favorites-btn:hover {
            background: #FF5252;
        }

        .close-favorites-btn {
            background: #666;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-favorites-btn:hover {
            background: #555;
        }

        /* Add favorite button in player */
        .favorite-btn {
            background: none;
            border: none;
            color: #ccc;
            cursor: pointer;
            font-size: 1.5em;
            padding: 8px;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .favorite-btn:hover {
            color: #FF6B6B;
            transform: scale(1.1);
        }

        .favorite-btn.active {
            color: #FF6B6B;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            🎵 正在加载声音疗愈空间...<br>
            <small>请稍候，正在加载221个疗愈音频</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app">
        <!-- Background Canvas -->
        <canvas id="backgroundCanvas"></canvas>

        <!-- Controls Bar -->
        <div class="controls-bar">
            <div class="control-icon theme-icon" onclick="toggleTheme()" title="切换主题">🌙</div>
            <div class="control-icon" onclick="openSleepTimer()" title="睡眠定时器">⏰</div>
            <div class="control-icon" onclick="toggleLowPowerMode()" title="低功耗模式" id="lowPowerIcon">⚡</div>
            <div class="control-icon" onclick="showHistory()" title="播放历史">📜</div>
            <div class="control-icon" onclick="toggleFavorites()" title="收藏夹">❤️</div>
            <div class="control-icon" onclick="togglePlaylistMode()" title="播放模式">🔀</div>
        </div>

        <!-- Header -->
        <header class="header">
            <h1>🎵 声音疗愈空间</h1>
            <p class="subtitle">专业音频疗法平台 - 221+种疗愈音频</p>
        </header>

        <!-- Category Section -->
        <section class="category-section">
            <div id="categoryGrid" class="category-grid">
                <!-- Categories will be loaded here -->
            </div>
        </section>

        <!-- Playlist Modal -->
        <div id="playlistModal" class="playlist-modal">
            <div class="playlist-content">
                <div class="playlist-header">
                    <h2 id="playlistTitle" class="playlist-title">选择音频</h2>
                    <span class="close-btn" onclick="closePlaylist()">&times;</span>
                </div>
                <div id="trackList" class="track-list">
                    <!-- Tracks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Sleep Timer Modal -->
        <div id="timerModal" class="timer-modal">
            <h3>睡眠定时器</h3>
            <div class="timer-status" id="timerStatus">
                <div class="status-text">当前未设置定时器</div>
                <div class="countdown-display" id="countdownDisplay"></div>
            </div>
            <div class="timer-preset">
                <div class="timer-label">快速设置：</div>
                <div class="timer-options">
                    <div class="timer-btn" onclick="setTimer(5)">5分钟</div>
                    <div class="timer-btn" onclick="setTimer(10)">10分钟</div>
                    <div class="timer-btn" onclick="setTimer(15)">15分钟</div>
                    <div class="timer-btn" onclick="setTimer(30)">30分钟</div>
                    <div class="timer-btn" onclick="setTimer(60)">60分钟</div>
                    <div class="timer-btn" onclick="setTimer(90)">90分钟</div>
                </div>
            </div>
            <div class="timer-custom">
                <div class="timer-label">自定义时间：</div>
                <div class="custom-input">
                    <input type="number" id="customMinutes" min="1" max="480" value="30" placeholder="分钟">
                    <button class="timer-btn set-btn" onclick="setCustomTimer()">设置</button>
                </div>
            </div>
            <div class="timer-options">
                <div class="timer-btn cancel-btn" onclick="setTimer(0)">关闭定时器</div>
            </div>
            <div class="timer-features">
                <label class="feature-label">
                    <input type="checkbox" id="fadeoutEnabled" checked>
                    渐隐关闭（最后30秒音量逐渐降低）
                </label>
            </div>
        </div>

        <!-- Play History Modal -->
        <div id="historyModal" class="history-modal">
            <h3>播放历史</h3>
            <div class="history-content" id="historyContent">
                <div class="empty-history">暂无播放历史</div>
            </div>
            <div class="history-actions">
                <button class="clear-history-btn" onclick="clearHistory()">清空历史</button>
                <button class="close-history-btn" onclick="closeHistory()">关闭</button>
            </div>
        </div>

        <!-- Favorites Modal -->
        <div id="favoritesModal" class="favorites-modal">
            <h3>我的收藏</h3>
            <div class="favorites-content" id="favoritesContent">
                <div class="empty-favorites">暂无收藏内容</div>
            </div>
            <div class="favorites-actions">
                <button class="play-all-favorites-btn" onclick="playAllFavorites()">播放全部</button>
                <button class="clear-favorites-btn" onclick="clearFavorites()">清空收藏</button>
                <button class="close-favorites-btn" onclick="closeFavorites()">关闭</button>
            </div>
        </div>

        <!-- Audio Player -->
        <div id="audioPlayer" class="audio-player" onclick="if(isMinimized) toggleMinimize(event)">
            <div class="minimize-indicator" onclick="toggleMinimize(event)">▲ 收起</div>
            <div class="minimized-display">
                <div class="minimized-text" id="minimizedTrack">未播放</div>
            </div>
            <div class="player-content">
                <div class="now-playing">
                    <div id="currentTrack" class="track-title">未播放</div>
                    <div id="currentCategory" class="track-category"></div>
                    <button id="favoriteBtn" class="favorite-btn" onclick="toggleFavorite()" title="收藏">🤍</button>
                </div>

                <div class="player-controls">
                    <button class="control-btn" onclick="previousTrack()">⏮️</button>
                    <button id="playPauseBtn" class="control-btn play-btn" onclick="togglePlayPause()">▶️</button>
                    <button class="control-btn" onclick="nextTrack()">⏭️</button>
                    <button class="control-btn" onclick="stopAudio()">⏹️</button>
                </div>

                <div class="progress-container">
                    <span id="currentTime" class="time-display">0:00</span>
                    <div class="progress-bar" onclick="seekTo(event)">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <span id="duration" class="time-display">0:00</span>
                </div>

                <div class="extra-controls">
                    <div class="speed-control">
                        <span class="speed-label">速度:</span>
                        <div class="speed-options">
                            <button class="speed-btn" data-rate="0.5" onclick="setPlaybackRate(0.5, event)">0.5x</button>
                            <button class="speed-btn" data-rate="0.75" onclick="setPlaybackRate(0.75, event)">0.75x</button>
                            <button class="speed-btn active" data-rate="1" onclick="setPlaybackRate(1, event)">1x</button>
                            <button class="speed-btn" data-rate="1.25" onclick="setPlaybackRate(1.25, event)">1.25x</button>
                            <button class="speed-btn" data-rate="1.5" onclick="setPlaybackRate(1.5, event)">1.5x</button>
                            <button class="speed-btn" data-rate="2" onclick="setPlaybackRate(2, event)">2x</button>
                        </div>
                    </div>

                    <div class="volume-container">
                        <span>🔊</span>
                        <div class="volume-slider" onclick="setVolume(event)">
                            <div id="volumeFill" class="volume-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="notification"></div>
    </div>

    <!-- Audio Configuration -->
    <script src="assets/js/audio-config.js"></script>

    <script>
        console.log('Script starting...');

        // Global Variables
        let currentCategory = null;
        let currentTrackIndex = -1;
        let isPlaying = false;
        let isShuffleMode = false;
        let isRepeatMode = false;
        let sleepTimer = null;
        let audio = new Audio();
        let tracks = [];

        console.log('Variables declared successfully');

        // Fallback Audio Data (in case external config fails to load)
        const audioData = {
            meditation: [
                { name: '深度冥想引导', url: 'https://archive.org/download/sound-healing-collection/meditation/Deep%20Meditation.mp3' },
                { name: '呼吸冥想练习', url: 'https://archive.org/download/sound-healing-collection/meditation/Breathing%20Meditation.mp3' },
                { name: '正念冥想', url: 'https://archive.org/download/sound-healing-collection/meditation/Mindfulness%20Meditation.mp3' }
            ],
            nature: [
                { name: '森林鸟鸣', url: 'https://archive.org/download/sound-healing-collection/nature/Forest%20Birds.mp3' },
                { name: '海浪声', url: 'https://archive.org/download/sound-healing-collection/nature/Ocean%20Waves.mp3' },
                { name: '溪流声', url: 'https://archive.org/download/sound-healing-collection/nature/Stream%20Sounds.mp3' }
            ],
            rain: [
                { name: '轻柔雨声', url: 'https://archive.org/download/sound-healing-collection/rain/Gentle%20Rain.mp3' },
                { name: '雷雨声', url: 'https://archive.org/download/sound-healing-collection/rain/Thunderstorm.mp3' },
                { name: '雨夜声音', url: 'https://archive.org/download/sound-healing-collection/rain/Rainy%20Night.mp3' }
            ],
            singing: [
                { name: '颂钵冥想', url: 'https://archive.org/download/sound-healing-collection/singing-bowl/Singing%20Bowl%20Meditation.mp3' },
                { name: ' Tibetan Singing Bowl', url: 'https://archive.org/download/sound-healing-collection/singing-bowl/Tibetan%20Bowl.mp3' },
                { name: 'Chakra Healing', url: 'https://archive.org/download/sound-healing-collection/singing-bowl/Chakra%20Healing.mp3' }
            ]
        };

        // Theme Management
        let isDarkTheme = true;
        let isMinimized = false;
        let autoHideTimer = null;

        // 状态持久化键名
        const STATE_KEYS = {
            TRACK_INDEX: 'soundHealing_trackIndex',
            CATEGORY: 'soundHealing_category',
            IS_PLAYING: 'soundHealing_isPlaying',
            CURRENT_TIME: 'soundHealing_currentTime',
            IS_MINIMIZED: 'soundHealing_isMinimized',
            SHUFFLE_MODE: 'soundHealing_shuffleMode',
            REPEAT_MODE: 'soundHealing_repeatMode',
            THEME: 'soundHealing_theme',
            VOLUME: 'soundHealing_volume',
            PLAYBACK_RATE: 'soundHealing_playbackRate'
        };

        // 触摸手势支持
        let touchStartX = 0;
        let touchEndX = 0;

        function handleTouchStart(event) {
            touchStartX = event.changedTouches[0].screenX;
        }

        function handleTouchEnd(event) {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipe();
        }

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // 向左滑动 - 下一曲
                    nextTrack();
                } else {
                    // 向右滑动 - 上一曲
                    previousTrack();
                }
            }
        }

        // 定时保存状态
        let autoSaveTimer = null;
        function startAutoSave() {
            if (autoSaveTimer) clearInterval(autoSaveTimer);
            autoSaveTimer = setInterval(() => {
                if (isPlaying) {
                    savePlayerState();
                }
            }, 5000); // 每5秒保存一次
        }

        function stopAutoSave() {
            if (autoSaveTimer) {
                clearInterval(autoSaveTimer);
                autoSaveTimer = null;
            }
        }

        // Background Scene Manager
        let canvas, ctx;
        let particles = [];
        let currentScene = 'default';

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialize canvas
            canvas = document.getElementById('backgroundCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Load categories
            loadCategories();

            // Initialize audio events
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('ended', handleTrackEnd);
            audio.addEventListener('loadedmetadata', updateDuration);

            // Setup player interaction
            setupPlayerInteraction();

            // 恢复播放器状态
            loadPlayerState();

            // Load play history
            loadHistory();

            // Load favorites
            loadFavorites();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('app').style.display = 'block';

                // Start background animation
                animateBackground();

                showNotification('声音疗愈空间已准备就绪！');
            }, 1500);
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function loadCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';

            if (typeof AUDIO_CONFIG !== 'undefined' && AUDIO_CONFIG.categories) {
                Object.entries(AUDIO_CONFIG.categories).forEach(([key, category]) => {
                    const categoryCard = createCategoryCard(key, category);
                    categoryGrid.appendChild(categoryCard);
                });
            } else {
                // Use fallback audioData
                const fallbackCategories = [
                    { key: 'meditation', name: '冥想音乐', icon: '🧘', desc: '深度放松', count: audioData.meditation.length },
                    { key: 'nature', name: '自然之声', icon: '🌿', desc: '鸟语花香', count: audioData.nature.length },
                    { key: 'rain', name: '雨声系列', icon: '🌧️', desc: '雨打芭蕉', count: audioData.rain.length },
                    { key: 'singing', name: '颂钵疗愈', icon: '🕯️', desc: '净化能量', count: audioData.singing.length }
                ];

                fallbackCategories.forEach(cat => {
                    const categoryCard = createCategoryCard(cat.key, cat);
                    categoryGrid.appendChild(categoryCard);
                });
            }
        }

        function createCategoryCard(key, category) {
            const card = document.createElement('div');
            card.className = 'category-card';
            card.onclick = () => openPlaylist(key, category);

            const count = category.files ? category.files.length : (category.count || 0);

            card.innerHTML = `
                <div class="category-icon">${category.icon || '🎵'}</div>
                <div class="category-name">${category.name || key}</div>
                <div class="category-desc">${category.desc || '疗愈音乐'}</div>
                <div class="category-count">${count} 个音频</div>
            `;

            return card;
        }

        function openPlaylist(categoryKey, category) {
            currentCategory = { key: categoryKey, ...category };

            document.getElementById('playlistTitle').textContent = category.name || categoryKey;
            const trackList = document.getElementById('trackList');
            trackList.innerHTML = '';

            // Load tracks
            if (category.files && typeof AUDIO_CONFIG !== 'undefined' && AUDIO_CONFIG.baseUrl) {
                tracks = category.files.map((fileName, index) => ({
                    name: fileName.replace(/\.[^/.]+$/, ""), // Remove extension
                    fileName: fileName,
                    url: AUDIO_CONFIG.baseUrl + category.folder + '/' + fileName
                }));
            } else {
                // Use fallback audioData
                tracks = audioData[categoryKey] || [
                    { name: '示例音频', fileName: 'sample.mp3', url: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav' }
                ];
            }

            // Display tracks
            tracks.forEach((track, index) => {
                const trackItem = document.createElement('div');
                trackItem.className = 'track-item';
                trackItem.onclick = () => playTrack(index);

                trackItem.innerHTML = `
                    <div class="track-icon">🎵</div>
                    <div class="track-info">
                        <div class="track-name">${track.name}</div>
                        <div class="track-duration">--:--</div>
                    </div>
                `;

                trackList.appendChild(trackItem);
            });

            // Change background scene
            changeBackgroundScene(categoryKey);

            // Show modal
            document.getElementById('playlistModal').style.display = 'block';
        }

        function closePlaylist() {
            document.getElementById('playlistModal').style.display = 'none';
        }

        function playTrack(index) {
            try {
                if (!tracks || !tracks[index]) {
                    throw new Error('音轨不存在');
                }

                currentTrackIndex = index;
                const track = tracks[index];

                if (!track || !track.url) {
                    throw new Error('音轨数据无效');
                }

                showNotification('正在加载音频...', 'info');

                audio.src = track.url;
                audio.play().then(() => {
                    isPlaying = true;
                    updatePlayButton();
                    showNowPlaying(track);
                    showPlayer();
                    updateFavoriteButton();
                    savePlayerState();
                    startAutoSave();

                    // Add to play history
                    addToHistory(track, categoryNames[currentCategory]);

                    showNotification('播放开始', 'success');
                }).catch(e => {
                    console.error('播放失败:', e);
                    isPlaying = false;
                    updatePlayButton();

                    // 根据错误类型显示不同的提示
                    if (e.name === 'NotSupportedError') {
                        showNotification('音频格式不支持', 'error');
                    } else if (e.name === 'NetworkError') {
                        showNotification('网络连接失败，请检查网络', 'error');
                    } else {
                        showNotification('播放失败，请稍后重试', 'error');
                    }
                });
            } catch (e) {
                console.error('播放错误:', e);
                showNotification('播放失败：' + e.message, 'error');
            }

            closePlaylist();
        }

        function togglePlayPause() {
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
                stopAutoSave();
            } else {
                audio.play();
                isPlaying = true;
                startAutoSave();
            }
            updatePlayButton();
            savePlayerState();
        }

        function stopAudio() {
            audio.pause();
            audio.currentTime = 0;
            isPlaying = false;
            updatePlayButton();
            stopAutoSave();
            savePlayerState();
            hidePlayer();
        }

        function previousTrack() {
            if (currentTrackIndex > 0) {
                playTrack(currentTrackIndex - 1);
            } else if (isRepeatMode) {
                playTrack(tracks.length - 1);
            }
        }

        function nextTrack() {
            if (isShuffleMode) {
                const randomIndex = Math.floor(Math.random() * tracks.length);
                playTrack(randomIndex);
            } else if (currentTrackIndex < tracks.length - 1) {
                playTrack(currentTrackIndex + 1);
            } else if (isRepeatMode) {
                playTrack(0);
            }
        }

        function handleTrackEnd() {
            if (isRepeatMode && currentTrackIndex === tracks.length - 1) {
                playTrack(0);
            } else if (currentTrackIndex < tracks.length - 1) {
                nextTrack();
            } else {
                isPlaying = false;
                updatePlayButton();
            }
        }

        function updateProgress() {
            const progress = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
        }

        function updateDuration() {
            document.getElementById('duration').textContent = formatTime(audio.duration);
        }

        function seekTo(event) {
            const progressBar = event.currentTarget;
            const clickX = event.offsetX;
            const width = progressBar.offsetWidth;
            const percentage = clickX / width;
            audio.currentTime = audio.duration * percentage;
        }

        function setVolume(event) {
            const slider = event.currentTarget;
            const clickX = event.offsetX;
            const width = slider.offsetWidth;
            const volume = clickX / width;
            audio.volume = volume;
            document.getElementById('volumeFill').style.width = (volume * 100) + '%';
            savePlayerState();
        }

        function setPlaybackRate(rate, event) {
            if (event) {
                event.stopPropagation();
            }

            try {
                audio.playbackRate = rate;

                // 更新按钮状态
                document.querySelectorAll('.speed-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // 找到并激活对应的按钮
                const targetBtn = document.querySelector(`.speed-btn[data-rate="${rate}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }

                // 显示提示
                showNotification(`播放速度: ${rate}x`, 'info');
                savePlayerState();
            } catch (e) {
                console.error('设置播放速度失败:', e);
                showNotification('无法设置播放速度', 'error');
            }
        }

        function updatePlayButton() {
            const btn = document.getElementById('playPauseBtn');
            btn.textContent = isPlaying ? '⏸️' : '▶️';
        }

        function showNowPlaying(track) {
            document.getElementById('currentTrack').textContent = track.name;
            document.getElementById('currentCategory').textContent = currentCategory.name || currentCategory.key;
            document.getElementById('minimizedTrack').textContent = track.name;
        }

        // 状态持久化函数
        function savePlayerState() {
            try {
                const state = {
                    trackIndex: currentTrackIndex,
                    category: currentCategory,
                    isPlaying: isPlaying,
                    currentTime: audio.currentTime,
                    isMinimized: isMinimized,
                    shuffleMode: isShuffleMode,
                    repeatMode: isRepeatMode,
                    theme: isDarkTheme,
                    volume: audio.volume
                };
                Object.keys(state).forEach(key => {
                    localStorage.setItem(STATE_KEYS[key.toUpperCase()], JSON.stringify(state[key]));
                });
            } catch (e) {
                console.error('保存状态失败:', e);
            }
        }

        function loadPlayerState() {
            try {
                const state = {};
                Object.keys(STATE_KEYS).forEach(key => {
                    const value = localStorage.getItem(STATE_KEYS[key]);
                    state[key.toLowerCase()] = value ? JSON.parse(value) : null;
                });

                // 恢复状态
                if (state.category !== null && audioData[state.category]) {
                    currentCategory = state.category;
                    tracks = audioData[state.category];
                }
                if (state.trackIndex !== null && state.trackIndex >= 0) {
                    currentTrackIndex = state.trackIndex;
                }
                if (state.isPlaying !== null) {
                    isPlaying = state.isPlaying;
                }
                if (state.shuffleMode !== null) {
                    isShuffleMode = state.shuffleMode;
                }
                if (state.repeatMode !== null) {
                    isRepeatMode = state.repeatMode;
                }
                if (state.theme !== null) {
                    isDarkTheme = state.theme;
                    applyTheme();
                }
                if (state.volume !== null) {
                    audio.volume = state.volume;
                }
                if (state.playbackRate !== null) {
                    audio.playbackRate = state.playbackRate;

                    // 更新速度按钮状态
                    document.querySelectorAll('.speed-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });

                    // 找到并激活对应的按钮
                    const targetBtn = document.querySelector(`.speed-btn[data-rate="${state.playbackRate}"]`);
                    if (targetBtn) {
                        targetBtn.classList.add('active');
                    }
                }

                // 如果有正在播放的音轨，恢复播放
                if (state.category && state.trackIndex >= 0 && tracks[state.trackIndex]) {
                    const track = tracks[state.trackIndex];
                    audio.src = track.url;
                    if (state.currentTime) {
                        audio.currentTime = state.currentTime;
                    }
                    updateNowPlaying(track);
                    showPlayer();
                    if (state.isMinimized) {
                        toggleMinimize();
                    }
                    if (state.isPlaying) {
                        audio.play().catch(e => {
                            console.log('自动播放失败，需要用户交互:', e);
                            isPlaying = false;
                            updatePlayButton();
                        });
                    }
                }
            } catch (e) {
                console.error('恢复状态失败:', e);
            }
        }

        function showPlayer() {
            const player = document.getElementById('audioPlayer');
            player.classList.add('show');
            player.classList.remove('minimized');
            isMinimized = false;

            // 设置自动隐藏
            resetAutoHideTimer();
        }

        function hidePlayer() {
            const player = document.getElementById('audioPlayer');
            player.classList.remove('show');
            player.classList.remove('minimized');

            if (autoHideTimer) {
                clearTimeout(autoHideTimer);
                autoHideTimer = null;
            }
        }

        function toggleMinimize(event) {
            // 阻止事件冒泡，避免触发播放器的点击事件
            if (event) {
                event.stopPropagation();
            }

            const player = document.getElementById('audioPlayer');
            const indicator = document.querySelector('.minimize-indicator');

            if (isMinimized) {
                player.classList.remove('minimized');
                indicator.textContent = '▲ 收起';
                resetAutoHideTimer();
            } else {
                player.classList.add('minimized');
                indicator.textContent = '▼ 展开';
                if (autoHideTimer) {
                    clearTimeout(autoHideTimer);
                    autoHideTimer = null;
                }
            }
            isMinimized = !isMinimized;
            savePlayerState();
        }

        function resetAutoHideTimer() {
            // 清除之前的定时器
            if (autoHideTimer) {
                clearTimeout(autoHideTimer);
            }

            // 30秒后自动收起
            autoHideTimer = setTimeout(() => {
                if (!isMinimized && isPlaying) {
                    toggleMinimize();
                    showNotification('播放器已自动收起，点击底部可展开');
                }
            }, 30000);
        }

        // 当用户与播放器交互时重置定时器
        function setupPlayerInteraction() {
            const player = document.getElementById('audioPlayer');

            // 鼠标进入播放器时
            player.addEventListener('mouseenter', () => {
                if (autoHideTimer && isMinimized === false) {
                    clearTimeout(autoHideTimer);
                    autoHideTimer = null;
                }
            });

            // 鼠标离开播放器时
            player.addEventListener('mouseleave', () => {
                if (autoHideTimer === null && isMinimized === false && isPlaying) {
                    resetAutoHideTimer();
                }
            });

            // 添加触摸手势支持
            player.addEventListener('touchstart', handleTouchStart, { passive: true });
            player.addEventListener('touchend', handleTouchEnd, { passive: true });

            // 点击播放器区域时
            player.addEventListener('click', (e) => {
                // 如果点击的是控制按钮，不重置定时器
                if (!e.target.closest('.control-btn') && !e.target.closest('.progress-bar') && !e.target.closest('.volume-slider')) {
                    resetAutoHideTimer();
                }
            });
        }

        function applyTheme() {
            const root = document.documentElement;

            if (isDarkTheme) {
                // 深色主题
                document.body.style.background = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)';
                document.body.style.color = '#ffffff';

                // 更新CSS变量
                root.style.setProperty('--bg-primary', '#1a1a2e');
                root.style.setProperty('--bg-secondary', '#16213e');
                root.style.setProperty('--bg-accent', '#0f3460');
                root.style.setProperty('--text-primary', '#ffffff');
                root.style.setProperty('--text-secondary', '#b8bcc8');
                root.style.setProperty('--accent-gradient', 'linear-gradient(135deg, #6666FF 0%, #FF6699 100%)');

                // 更新各组件样式
                updateThemeForComponents('dark');
            } else {
                // 浅色主题
                document.body.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)';
                document.body.style.color = '#2d3748';

                // 更新CSS变量
                root.style.setProperty('--bg-primary', '#ffffff');
                root.style.setProperty('--bg-secondary', '#f7fafc');
                root.style.setProperty('--bg-accent', '#edf2f7');
                root.style.setProperty('--text-primary', '#2d3748');
                root.style.setProperty('--text-secondary', '#4a5568');
                root.style.setProperty('--accent-gradient', 'linear-gradient(135deg, #4299e1 0%, #ed64a6 100%)');

                // 更新各组件样式
                updateThemeForComponents('light');
            }

            // 更新主题图标
            const themeIcon = document.querySelector('.theme-icon');
            if (themeIcon) {
                themeIcon.textContent = isDarkTheme ? '🌙' : '☀️';
            }
        }

        function updateThemeForComponents(theme) {
            // 更新播放器样式
            const player = document.getElementById('audioPlayer');
            if (player) {
                player.style.background = theme === 'dark' ?
                    'rgba(26, 26, 46, 0.95)' : 'rgba(255, 255, 255, 0.95)';
                player.style.backdropFilter = 'blur(20px)';
            }

            // 更新分类卡片样式
            const cards = document.querySelectorAll('.category-card');
            cards.forEach(card => {
                if (theme === 'dark') {
                    card.style.background = 'rgba(255, 255, 255, 0.1)';
                    card.style.color = 'white';
                } else {
                    card.style.background = 'rgba(255, 255, 255, 0.8)';
                    card.style.color = '#2d3748';
                    card.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
                }
            });

            // 更新模态框样式
            const modals = document.querySelectorAll('.modal-content');
            modals.forEach(modal => {
                if (theme === 'dark') {
                    modal.style.background = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)';
                    modal.style.color = 'white';
                } else {
                    modal.style.background = 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)';
                    modal.style.color = '#2d3748';
                }
            });

            // 更新控制栏样式
            const controls = document.querySelectorAll('.control-icon');
            controls.forEach(control => {
                control.style.background = theme === 'dark' ?
                    'rgba(0, 0, 0, 0.5)' : 'rgba(255, 255, 255, 0.8)';
            });
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            applyTheme();
            savePlayerState();
            showNotification(isDarkTheme ? '已切换到深色主题' : '已切换到浅色主题');
        }

        function toggleLowPowerMode() {
            isLowPowerMode = !isLowPowerMode;
            const icon = document.getElementById('lowPowerIcon');

            if (isLowPowerMode) {
                // Low power mode: reduce animation quality
                canvas.style.opacity = '0.3';
                icon.style.opacity = '0.5';
                icon.textContent = '🔋';
                showNotification('低功耗模式已开启');

                // Reduce frame rate or pause animation
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                // Use a slower animation interval
                setTimeout(() => {
                    if (isLowPowerMode) {
                        animateBackgroundSlow();
                    }
                }, 100);
            } else {
                // Normal mode
                canvas.style.opacity = '0.6';
                icon.style.opacity = '1';
                icon.textContent = '⚡';
                showNotification('低功耗模式已关闭');

                // Resume normal animation
                if (!animationId) {
                    animateBackground();
                }
            }
        }

        function animateBackgroundSlow() {
            if (!isTabVisible || !isLowPowerMode) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Update only every 3rd particle for performance
            for (let i = 0; i < particles.length; i += 3) {
                const particle = particles[i];
                particle.x += particle.vx * 0.5;
                particle.y += particle.vy * 0.5;

                // Wrap around edges
                if (particle.x < 0) particle.x = canvas.width;
                if (particle.x > canvas.width) particle.x = 0;
                if (particle.y < 0) particle.y = canvas.height;
                if (particle.y > canvas.height) particle.y = 0;

                // Draw particle
                ctx.save();
                ctx.globalAlpha = particle.opacity || 0.3;
                ctx.fillStyle = particle.color;
                drawCircle(particle);
                ctx.restore();
            }

            // Slower animation for low power mode
            setTimeout(() => {
                if (isLowPowerMode) {
                    animateBackgroundSlow();
                }
            }, 100);
        }

        function togglePlaylistMode() {
            if (!isShuffleMode && !isRepeatMode) {
                isShuffleMode = true;
                showNotification('随机播放已开启');
            } else if (isShuffleMode) {
                isShuffleMode = false;
                isRepeatMode = true;
                showNotification('循环播放已开启');
            } else {
                isRepeatMode = false;
                showNotification('顺序播放模式');
            }
        }

        function openSleepTimer() {
            document.getElementById('timerModal').style.display = 'block';
        }

        // 睡眠定时器相关变量
        // sleepTimer is already declared at line 1297
        let countdownTimer = null;
        let timerEndTime = null;
        let originalVolume = 1.0;

        function setTimer(minutes) {
            // 清除现有定时器
            if (sleepTimer) {
                clearTimeout(sleepTimer);
                sleepTimer = null;
            }
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }

            if (minutes > 0) {
                // 设置定时器结束时间
                timerEndTime = Date.now() + (minutes * 60 * 1000);
                originalVolume = audio.volume;

                // 显示倒计时
                updateCountdown();
                countdownTimer = setInterval(updateCountdown, 1000);

                // 检查是否启用渐隐
                const fadeoutEnabled = document.getElementById('fadeoutEnabled').checked;
                const totalMs = minutes * 60 * 1000;

                if (fadeoutEnabled && totalMs > 30000) {
                    // 设置主定时器（在渐隐开始前30秒）
                    sleepTimer = setTimeout(() => {
                        startFadeout();
                    }, totalMs - 30000);
                } else {
                    // 直接设置定时器
                    sleepTimer = setTimeout(() => {
                        stopAudio();
                        showNotification('睡眠定时器已停止播放');
                        clearTimerDisplay();
                    }, totalMs);
                }

                showNotification(`睡眠定时器已设置为${minutes}分钟`);
                updateTimerStatus(`${minutes}分钟`, true);
            } else {
                // 关闭定时器
                clearTimerDisplay();
                showNotification('睡眠定时器已关闭');
                updateTimerStatus('当前未设置定时器', false);
            }

            document.getElementById('timerModal').style.display = 'none';
        }

        function setCustomTimer() {
            const minutes = parseInt(document.getElementById('customMinutes').value);
            if (minutes && minutes > 0 && minutes <= 480) {
                setTimer(minutes);
            } else {
                showNotification('请输入1-480之间的分钟数', 'error');
            }
        }

        function updateCountdown() {
            if (!timerEndTime) return;

            const remaining = timerEndTime - Date.now();
            if (remaining <= 0) {
                clearTimerDisplay();
                return;
            }

            const minutes = Math.floor(remaining / 60000);
            const seconds = Math.floor((remaining % 60000) / 1000);
            const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('countdownDisplay').textContent = display;

            // 更新控制栏图标
            const timerIcon = document.querySelector('.control-icon[title="睡眠定时器"]');
            if (timerIcon) {
                timerIcon.style.opacity = '0.7';
                timerIcon.title = `睡眠定时器: ${display}`;
            }
        }

        function startFadeout() {
            const fadeoutDuration = 30000; // 30秒
            const fadeSteps = 30; // 30步
            const fadeInterval = fadeoutDuration / fadeSteps;
            const volumeStep = originalVolume / fadeSteps;
            let currentStep = 0;

            const fadeIntervalId = setInterval(() => {
                currentStep++;
                const newVolume = Math.max(0, originalVolume - (volumeStep * currentStep));
                audio.volume = newVolume;

                if (currentStep >= fadeSteps) {
                    clearInterval(fadeIntervalId);
                    stopAudio();
                    showNotification('睡眠定时器已停止播放（渐隐）');
                    clearTimerDisplay();
                }
            }, fadeInterval);

            // 更新定时器引用
            sleepTimer = fadeIntervalId;
        }

        function updateTimerStatus(text, isActive) {
            const statusText = document.querySelector('.status-text');
            if (statusText) {
                statusText.textContent = isActive ? `定时器运行中: ${text}` : text;
            }

            // 更新主题按钮状态
            const timerIcon = document.querySelector('.control-icon[title="睡眠定时器"]');
            if (timerIcon) {
                timerIcon.style.opacity = isActive ? '0.7' : '1';
            }
        }

        function clearTimerDisplay() {
            if (countdownTimer) {
                clearInterval(countdownTimer);
                countdownTimer = null;
            }
            timerEndTime = null;
            document.getElementById('countdownDisplay').textContent = '';
            const timerIcon = document.querySelector('.control-icon[title="睡眠定时器"]');
            if (timerIcon) {
                timerIcon.style.opacity = '1';
                timerIcon.title = '睡眠定时器';
            }
        }

        // Play History functionality
        const MAX_HISTORY_ITEMS = 50;
        let playHistory = [];
        let favorites = [];

        // Load history from localStorage on startup
        function loadHistory() {
            const saved = localStorage.getItem('soundHealing_playHistory');
            if (saved) {
                try {
                    playHistory = JSON.parse(saved);
                } catch (e) {
                    console.error('Failed to parse play history:', e);
                    playHistory = [];
                }
            }
        }
        }

        // Load favorites from localStorage
        function loadFavorites() {
            const saved = localStorage.getItem('soundHealing_favorites');
            if (saved) {
                try {
                    favorites = JSON.parse(saved);
                } catch (e) {
                    console.error('Failed to parse favorites:', e);
                    favorites = [];
                }
            }
        }

        // Save favorites to localStorage
        function saveFavorites() {
            localStorage.setItem('soundHealing_favorites', JSON.stringify(favorites));
        }

        // Toggle favorite status
        function toggleFavorite() {
            const trackName = document.getElementById('currentTrack').textContent;
            const categoryName = document.getElementById('currentCategory').textContent;
            const favoriteBtn = document.getElementById('favoriteBtn');

            if (!trackName || trackName === '未播放') {
                showNotification('没有正在播放的音频', 'error');
                return;
            }

            // Check if already in favorites
            const existingIndex = favorites.findIndex(fav =>
                fav.name === trackName && fav.category === categoryName
            );

            if (existingIndex > -1) {
                // Remove from favorites
                favorites.splice(existingIndex, 1);
                favoriteBtn.textContent = '🤍';
                favoriteBtn.classList.remove('active');
                showNotification('已取消收藏', 'info');
            } else {
                // Add to favorites
                const currentTrack = tracks[currentTrackIndex];
                if (currentTrack) {
                    favorites.unshift({
                        name: trackName,
                        category: categoryName,
                        url: currentTrack.url,
                        addedAt: new Date().toISOString()
                    });
                    favoriteBtn.textContent = '❤️';
                    favoriteBtn.classList.add('active');
                    showNotification('已添加到收藏', 'success');
                }
            }

            saveFavorites();
        }

        // Check if current track is in favorites
        function updateFavoriteButton() {
            const trackName = document.getElementById('currentTrack').textContent;
            const categoryName = document.getElementById('currentCategory').textContent;
            const favoriteBtn = document.getElementById('favoriteBtn');

            if (!trackName || trackName === '未播放') {
                favoriteBtn.textContent = '🤍';
                favoriteBtn.classList.remove('active');
                return;
            }

            const isInFavorites = favorites.some(fav =>
                fav.name === trackName && fav.category === categoryName
            );

            if (isInFavorites) {
                favoriteBtn.textContent = '❤️';
                favoriteBtn.classList.add('active');
            } else {
                favoriteBtn.textContent = '🤍';
                favoriteBtn.classList.remove('active');
            }
        }

        // Show favorites modal
        function toggleFavorites() {
            const modal = document.getElementById('favoritesModal');
            if (modal.style.display === 'block') {
                closeFavorites();
            } else {
                showFavorites();
            }
        }

        // Show favorites modal
        function showFavorites() {
            loadFavorites();
            updateFavoritesDisplay();
            document.getElementById('favoritesModal').style.display = 'block';
        }

        // Close favorites modal
        function closeFavorites() {
            document.getElementById('favoritesModal').style.display = 'none';
        }

        // Update favorites display
        function updateFavoritesDisplay() {
            const content = document.getElementById('favoritesContent');

            if (favorites.length === 0) {
                content.innerHTML = '<div class="empty-favorites">暂无收藏内容</div>';
                return;
            }

            content.innerHTML = favorites.map((fav, index) => `
                <div class="favorites-item">
                    <div class="favorites-info">
                        <div class="favorites-name">${fav.name}</div>
                        <div class="favorites-category">${fav.category}</div>
                    </div>
                    <div class="favorites-item-actions">
                        <button class="favorites-play-btn" onclick="playFavorite(${index})">播放</button>
                        <button class="favorites-remove-btn" onclick="removeFavorite(${index})" title="删除">🗑️</button>
                    </div>
                </div>
            `).join('');
        }

        // Play favorite track
        function playFavorite(index) {
            const fav = favorites[index];
            if (!fav) return;

            // Find the category
            const categoryKey = Object.keys(audioData).find(key =>
                categoryNames[key] === fav.category
            );

            if (categoryKey) {
                // Find the track in the category
                const track = audioData[categoryKey].find(t => t.name === fav.name);
                if (track) {
                    currentCategory = categoryKey;
                    tracks = audioData[categoryKey];
                    currentTrackIndex = tracks.indexOf(track);

                    // Play the track
                    audio.src = track.url;
                    audio.play();
                    isPlaying = true;
                    updatePlayButton();
                    updateNowPlaying(track);
                    showPlayer();
                    updateFavoriteButton();
                    closeFavorites();
                    showNotification(`正在播放: ${fav.name}`, 'success');
                }
            }
        }

        // Remove from favorites
        function removeFavorite(index) {
            favorites.splice(index, 1);
            saveFavorites();
            updateFavoritesDisplay();

            // Update favorite button if removing current track
            updateFavoriteButton();

            showNotification('已从收藏中移除', 'info');
        }

        // Clear all favorites
        function clearFavorites() {
            if (favorites.length === 0) {
                showNotification('收藏夹已经是空的', 'info');
                return;
            }

            if (confirm('确定要清空所有收藏吗？')) {
                favorites = [];
                saveFavorites();
                updateFavoritesDisplay();
                updateFavoriteButton();
                showNotification('收藏夹已清空', 'success');
            }
        }

        // Play all favorites
        function playAllFavorites() {
            if (favorites.length === 0) {
                showNotification('收藏夹为空', 'info');
                return;
            }

            // Create a playlist from favorites
            const favoritesPlaylist = [];
            favorites.forEach(fav => {
                const categoryKey = Object.keys(audioData).find(key =>
                    categoryNames[key] === fav.category
                );
                if (categoryKey) {
                    const track = audioData[categoryKey].find(t => t.name === fav.name);
                    if (track) {
                        favoritesPlaylist.push({
                            ...track,
                            categoryKey: categoryKey
                        });
                    }
                }
            });

            if (favoritesPlaylist.length > 0) {
                // Set up playlist mode with favorites
                tracks = favoritesPlaylist;
                currentTrackIndex = 0;
                isPlaylistMode = true;
                isShuffleOn = false;

                // Play first track
                playTrack(0);
                closeFavorites();
                showNotification(`开始播放收藏列表 (${favoritesPlaylist.length} 首)`, 'success');
            }
        }
        }

        // Add track to history
        function addToHistory(track, category) {
            // Remove if already exists
            playHistory = playHistory.filter(item =>
                !(item.name === track.name && item.category === category)
            );

            // Add to beginning
            playHistory.unshift({
                name: track.name,
                category: category,
                url: track.url,
                timestamp: new Date().toISOString()
            });

            // Limit history size
            if (playHistory.length > MAX_HISTORY_ITEMS) {
                playHistory = playHistory.slice(0, MAX_HISTORY_ITEMS);
            }

            saveHistory();
        }

        // Show history modal
        function showHistory() {
            loadHistory();
            updateHistoryDisplay();
            document.getElementById('historyModal').style.display = 'block';
        }

        // Close history modal
        function closeHistory() {
            document.getElementById('historyModal').style.display = 'none';
        }

        // Clear history
        function clearHistory() {
            if (confirm('确定要清空所有播放历史吗？')) {
                playHistory = [];
                saveHistory();
                updateHistoryDisplay();
                showNotification('播放历史已清空');
            }
        }

        // Update history display
        function updateHistoryDisplay() {
            const content = document.getElementById('historyContent');

            if (playHistory.length === 0) {
                content.innerHTML = '<div class="empty-history">暂无播放历史</div>';
                return;
            }

            content.innerHTML = '';
            playHistory.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const timeStr = formatHistoryTime(date);

                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <div class="history-track-info">
                        <div class="history-track-name">${item.name}</div>
                        <div class="history-track-category">${item.category}</div>
                        <div class="history-track-time">${timeStr}</div>
                    </div>
                    <button class="history-play-btn" onclick="playFromHistory(${index})">播放</button>
                `;
                content.appendChild(historyItem);
            });
        }

        // Format time for history display
        function formatHistoryTime(date) {
            const now = new Date();
            const diff = now - date;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor(diff / (1000 * 60));

            if (days > 0) {
                return `${days}天前`;
            } else if (hours > 0) {
                return `${hours}小时前`;
            } else if (minutes > 0) {
                return `${minutes}分钟前`;
            } else {
                return '刚刚';
            }
        }

        // Play track from history
        function playFromHistory(index) {
            const item = playHistory[index];
            if (item) {
                // Find the category
                const categoryKey = Object.keys(audioData).find(key =>
                    categoryNames[key] === item.category
                );

                if (categoryKey) {
                    // Find the track in the category
                    const track = audioData[categoryKey].find(t => t.name === item.name);
                    if (track) {
                        currentCategory = categoryKey;
                        tracks = audioData[categoryKey];
                        currentTrackIndex = tracks.indexOf(track);

                        // Play the track
                        audio.src = track.url;
                        audio.play();
                        updateNowPlaying(track);
                        showPlayer();
                        updatePlayButton();

                        // Add to history again (will move to top)
                        addToHistory(track, item.category);

                        closeHistory();
                        showNotification(`正在播放: ${track.name}`);
                    }
                }
            }
        }

        function changeBackgroundScene(category) {
            currentScene = category;
            particles = [];

            // Configure scene based on category
            const sceneConfigs = {
                'Animal sounds': { color: '#4CAF50', particleCount: 50, type: 'leaves' },
                'Chakra': { color: '#9C27B0', particleCount: 30, type: 'energy' },
                'Fire': { color: '#FF5722', particleCount: 40, type: 'sparks' },
                'hypnosis': { color: '#3F51B5', particleCount: 60, type: 'stars' },
                'meditation': { color: '#2196F3', particleCount: 20, type: 'bubbles' },
                'Rain': { color: '#00BCD4', particleCount: 80, type: 'rain' },
                'running water': { color: '#009688', particleCount: 40, type: 'waves' },
                'Singing bowl sound': { color: '#FFC107', particleCount: 25, type: 'rings' },
                'Subconscious Therapy': { color: '#673AB7', particleCount: 35, type: 'cosmic' }
            };

            const config = sceneConfigs[category] || sceneConfigs['default'];
            initParticles(config);
        }

        function initParticles(config) {
            // Reduce particle count on mobile for better performance
            const isMobile = window.innerWidth <= 768;
            const particleCount = isMobile ? Math.floor(config.particleCount * 0.5) : config.particleCount;

            // Clear existing particles
            particles.length = 0;

            // Pre-allocate array for better performance
            particles.length = particleCount;

            for (let i = 0; i < particleCount; i++) {
                particles[i] = {
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    size: Math.random() * 3 + 1,
                    color: config.color,
                    type: config.type,
                    angle: Math.random() * Math.PI * 2,
                    // Add opacity variation for visual interest
                    opacity: 0.3 + Math.random() * 0.4
                };
            }
        }

        // Performance optimization variables
        let animationId = null;
        let isTabVisible = true;
        let isLowPowerMode = false;

        // Page visibility API for performance
        document.addEventListener('visibilitychange', () => {
            isTabVisible = !document.hidden;
            if (!isTabVisible && animationId) {
                // Pause animation when tab is not visible
                cancelAnimationFrame(animationId);
                animationId = null;
            } else if (isTabVisible && !animationId) {
                // Resume animation when tab becomes visible
                animateBackground();
            }
        });

        function animateBackground() {
            if (!isTabVisible) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Use object pooling for better performance
            particles.forEach(particle => {
                // Update position
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.angle += 0.02;

                // Wrap around edges
                if (particle.x < 0) particle.x = canvas.width;
                if (particle.x > canvas.width) particle.x = 0;
                if (particle.y < 0) particle.y = canvas.height;
                if (particle.y > canvas.height) particle.y = 0;

                // Draw particle
                ctx.save();
                ctx.globalAlpha = particle.opacity || 0.6;
                ctx.fillStyle = particle.color;

                switch(particle.type) {
                    case 'leaves':
                        drawLeaf(particle);
                        break;
                    case 'energy':
                        drawEnergy(particle);
                        break;
                    case 'sparks':
                        drawSpark(particle);
                        break;
                    default:
                        drawCircle(particle);
                }

                ctx.restore();
            });

            // Track animation ID for cancellation
            animationId = requestAnimationFrame(animateBackground);
        }

        function drawCircle(particle) {
            ctx.beginPath();
            ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawLeaf(particle) {
            ctx.save();
            ctx.translate(particle.x, particle.y);
            ctx.rotate(particle.angle);
            ctx.beginPath();
            ctx.ellipse(0, 0, particle.size * 2, particle.size, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        function drawEnergy(particle) {
            const gradient = ctx.createRadialGradient(particle.x, particle.y, 0, particle.x, particle.y, particle.size * 3);
            gradient.addColorStop(0, particle.color);
            gradient.addColorStop(1, 'transparent');
            ctx.fillStyle = gradient;
            ctx.fillRect(particle.x - particle.size * 3, particle.y - particle.size * 3, particle.size * 6, particle.size * 6);
        }

        function drawSpark(particle) {
            ctx.beginPath();
            ctx.moveTo(particle.x, particle.y - particle.size * 2);
            ctx.lineTo(particle.x - particle.size, particle.y + particle.size);
            ctx.lineTo(particle.x + particle.size, particle.y + particle.size);
            ctx.closePath();
            ctx.fill();
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';

            // 根据类型设置不同的样式
            notification.className = 'notification ' + type;

            // 根据类型设置不同的显示时间
            let duration = 3000;
            if (type === 'error') {
                duration = 5000;
            } else if (type === 'success') {
                duration = 2000;
            }

            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const playlistModal = document.getElementById('playlistModal');
            const timerModal = document.getElementById('timerModal');
            const historyModal = document.getElementById('historyModal');
            const favoritesModal = document.getElementById('favoritesModal');

            if (event.target === playlistModal) {
                closePlaylist();
            }

            if (event.target === timerModal) {
                document.getElementById('timerModal').style.display = 'none';
            }

            if (event.target === historyModal) {
                closeHistory();
            }

            if (event.target === favoritesModal) {
                closeFavorites();
            }
        }

        // Initialize default background
        changeBackgroundScene('default');
    </script>
</body>
</html>