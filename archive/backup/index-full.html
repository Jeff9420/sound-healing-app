<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â£∞Èü≥ÁñóÊÑàÁ©∫Èó¥ - ‰∏ì‰∏öÈü≥È¢ëÁñóÊ≥ïÂπ≥Âè∞ | Sound Healing Space</title>

    <!-- Website Icons -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGRlZnM+CjxsaW5lYXJHcmFkaWVudCBpZD0iZ3JhZGllbnQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgo8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjY2NkZGO3N0b3Atb3BhY2l0eToxIiAvPgo8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNGRjY2OTk7c3RvcC1vcGFjaXR5OjEiIC8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPGV2ZyBwYXRoPSJNMTYgNEMxOC43NjE0IDQgMjEgNi4yMzg2IDIxIDlWMjNDMjEgMjUuNzYxNCAxOC43NjE0IDI4IDE2IDI4QzEzLjIzODYgMjggMTEgMjUuNzYxNCAxMSAyM1Y5QzExIDYuMjM4NiAxMy4yMzg2IDQgMTYgNFoiIGZpbGw9InVybCgjZ3JhZGllbnQpIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjMiIGZpbGw9IndoaXRlIi8+CjxjaXJjbGUgY3g9IjEwIiBjeT0iMTAiIHI9IjIiIGZpbGw9IndoaXRlIiBvcGFjaXR5PSIwLjciLz4KPGNpcmNsZSBjeD0iMjIiIGN5PSIyMiIgcj0iMiIgZmlsbD0id2hpdGUiIG9wYWNpdHk9IjAuNyIvPgo8L3N2Zz4K">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Â£∞Èü≥ÁñóÊÑàÁ©∫Èó¥ - ‰∏ì‰∏öÈü≥È¢ëÁñóÊ≥ïÂπ≥Âè∞ÔºåÊèê‰æõ221+ÁßçÁñóÊÑàÈü≥È¢ëÔºåÂåÖÊã¨Ëá™ÁÑ∂Â£∞Èü≥„ÄÅÂÜ•ÊÉ≥Èü≥‰πê„ÄÅÈ¢ÇÈíµÁñóÊÑàÁ≠â„ÄÇÂ∏ÆÂä©ÊÇ®ÊîæÊùæË∫´ÂøÉÔºåÊîπÂñÑÁù°Áú†ÔºåÂáèËΩªÂéãÂäõ„ÄÇ">
    <meta name="keywords" content="Â£∞Èü≥ÁñóÊÑà,Èü≥È¢ëÁñóÊ≥ï,ÂÜ•ÊÉ≥Èü≥‰πê,Âä©Áú†Èü≥‰πê,ÊîæÊùæÈü≥‰πê,Ëá™ÁÑ∂Â£∞Èü≥,È¢ÇÈíµÁñóÊÑà,ÂáèÂéãÈü≥‰πê,‰∏ìÊ≥®Èü≥‰πê,Ë∫´ÂøÉÂÅ•Â∫∑">
    <meta name="author" content="Sound Healing Space">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Microsoft YaHei', sans-serif;
            background: #1a1a1a;
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.2em;
            text-align: center;
        }

        /* Main App */
        #app {
            display: none;
            min-height: 100vh;
            position: relative;
        }

        /* Header */
        .header {
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            position: relative;
            z-index: 100;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.8;
        }

        /* Category Grid */
        .category-section {
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .category-card {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .category-card:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.15);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .category-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .category-name {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .category-desc {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .category-count {
            font-size: 0.8em;
            opacity: 0.5;
        }

        /* Playlist Modal */
        .playlist-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .playlist-content {
            position: relative;
            background: linear-gradient(135deg, rgba(102,102,255,0.9) 0%, rgba(255,102,153,0.9) 100%);
            margin: 50px auto;
            padding: 30px;
            width: 90%;
            max-width: 700px;
            border-radius: 25px;
            max-height: 80vh;
            overflow-y: auto;
            backdrop-filter: blur(20px);
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .playlist-title {
            font-size: 1.8em;
            font-weight: bold;
        }

        .close-btn {
            font-size: 2em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .close-btn:hover {
            transform: scale(1.2);
        }

        .track-list {
            display: grid;
            gap: 15px;
        }

        .track-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .track-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(10px);
        }

        .track-icon {
            font-size: 2em;
        }

        .track-info {
            flex: 1;
        }

        .track-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .track-duration {
            font-size: 0.9em;
            opacity: 0.7;
        }

        /* Audio Player */
        .audio-player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            padding: 25px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 500;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .audio-player.show {
            transform: translateY(0);
        }

        .player-content {
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .now-playing {
            text-align: center;
            margin-bottom: 10px;
        }

        .track-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .track-category {
            font-size: 0.9em;
            opacity: 0.7;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.1);
        }

        .play-btn {
            font-size: 2.5em;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            padding: 15px;
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #6666FF 0%, #FF6699 100%);
            border-radius: 3px;
            width: 0%;
            transition: width 0.1s;
        }

        .time-display {
            font-size: 0.9em;
            opacity: 0.7;
            min-width: 45px;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
        }

        .volume-fill {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 70%;
        }

        /* Controls Bar */
        .controls-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            z-index: 200;
        }

        .control-icon {
            width: 45px;
            height: 45px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2em;
        }

        .control-icon:hover {
            background: rgba(0,0,0,0.7);
            transform: scale(1.1);
        }

        /* Sleep Timer */
        .timer-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 20px;
            z-index: 1500;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .timer-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .timer-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .timer-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Background Canvas */
        #backgroundCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.6;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            z-index: 2000;
            display: none;
            backdrop-filter: blur(10px);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .category-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .category-card {
                padding: 20px;
            }

            .controls-bar {
                top: 10px;
                right: 10px;
            }

            .control-icon {
                width: 40px;
                height: 40px;
                font-size: 1em;
            }

            .player-controls {
                gap: 15px;
            }

            .volume-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            üéµ Ê≠£Âú®Âä†ËΩΩÂ£∞Èü≥ÁñóÊÑàÁ©∫Èó¥...<br>
            <small>ËØ∑Á®çÂÄôÔºåÊ≠£Âú®Âä†ËΩΩ221‰∏™ÁñóÊÑàÈü≥È¢ë</small>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app">
        <!-- Background Canvas -->
        <canvas id="backgroundCanvas"></canvas>

        <!-- Controls Bar -->
        <div class="controls-bar">
            <div class="control-icon" onclick="toggleTheme()" title="ÂàáÊç¢‰∏ªÈ¢ò">üåì</div>
            <div class="control-icon" onclick="openSleepTimer()" title="Áù°Áú†ÂÆöÊó∂Âô®">‚è∞</div>
            <div class="control-icon" onclick="togglePlaylistMode()" title="Êí≠ÊîæÊ®°Âºè">üîÄ</div>
        </div>

        <!-- Header -->
        <header class="header">
            <h1>üéµ Â£∞Èü≥ÁñóÊÑàÁ©∫Èó¥</h1>
            <p class="subtitle">‰∏ì‰∏öÈü≥È¢ëÁñóÊ≥ïÂπ≥Âè∞ - 221+ÁßçÁñóÊÑàÈü≥È¢ë</p>
        </header>

        <!-- Category Section -->
        <section class="category-section">
            <div id="categoryGrid" class="category-grid">
                <!-- Categories will be loaded here -->
            </div>
        </section>

        <!-- Playlist Modal -->
        <div id="playlistModal" class="playlist-modal">
            <div class="playlist-content">
                <div class="playlist-header">
                    <h2 id="playlistTitle" class="playlist-title">ÈÄâÊã©Èü≥È¢ë</h2>
                    <span class="close-btn" onclick="closePlaylist()">&times;</span>
                </div>
                <div id="trackList" class="track-list">
                    <!-- Tracks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Sleep Timer Modal -->
        <div id="timerModal" class="timer-modal">
            <h3>Áù°Áú†ÂÆöÊó∂Âô®</h3>
            <div class="timer-options">
                <div class="timer-btn" onclick="setTimer(5)">5ÂàÜÈíü</div>
                <div class="timer-btn" onclick="setTimer(10)">10ÂàÜÈíü</div>
                <div class="timer-btn" onclick="setTimer(15)">15ÂàÜÈíü</div>
                <div class="timer-btn" onclick="setTimer(30)">30ÂàÜÈíü</div>
                <div class="timer-btn" onclick="setTimer(60)">60ÂàÜÈíü</div>
                <div class="timer-btn" onclick="setTimer(0)">ÂÖ≥Èó≠</div>
            </div>
        </div>

        <!-- Audio Player -->
        <div id="audioPlayer" class="audio-player">
            <div class="player-content">
                <div class="now-playing">
                    <div id="currentTrack" class="track-title">Êú™Êí≠Êîæ</div>
                    <div id="currentCategory" class="track-category"></div>
                </div>

                <div class="player-controls">
                    <button class="control-btn" onclick="previousTrack()">‚èÆÔ∏è</button>
                    <button id="playPauseBtn" class="control-btn play-btn" onclick="togglePlayPause()">‚ñ∂Ô∏è</button>
                    <button class="control-btn" onclick="nextTrack()">‚è≠Ô∏è</button>
                    <button class="control-btn" onclick="stopAudio()">‚èπÔ∏è</button>
                </div>

                <div class="progress-container">
                    <span id="currentTime" class="time-display">0:00</span>
                    <div class="progress-bar" onclick="seekTo(event)">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <span id="duration" class="time-display">0:00</span>

                    <div class="volume-container">
                        <span>üîä</span>
                        <div class="volume-slider" onclick="setVolume(event)">
                            <div id="volumeFill" class="volume-fill"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div id="notification" class="notification"></div>
    </div>

    <!-- Audio Configuration -->
    <script src="assets/js/audio-config.js"></script>

    <script>
        // Global Variables
        let currentCategory = null;
        let currentTrackIndex = -1;
        let isPlaying = false;
        let isShuffleMode = false;
        let isRepeatMode = false;
        let sleepTimer = null;
        let audio = new Audio();
        let tracks = [];

        // Theme Management
        let isDarkTheme = true;

        // Background Scene Manager
        let canvas, ctx;
        let particles = [];
        let currentScene = 'default';

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialize canvas
            canvas = document.getElementById('backgroundCanvas');
            ctx = canvas.getContext('2d');
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // Load categories
            loadCategories();

            // Initialize audio events
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('ended', handleTrackEnd);
            audio.addEventListener('loadedmetadata', updateDuration);

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('app').style.display = 'block';

                // Start background animation
                animateBackground();

                showNotification('Â£∞Èü≥ÁñóÊÑàÁ©∫Èó¥Â∑≤ÂáÜÂ§áÂ∞±Áª™ÔºÅ');
            }, 1500);
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        function loadCategories() {
            const categoryGrid = document.getElementById('categoryGrid');
            categoryGrid.innerHTML = '';

            if (typeof AUDIO_CONFIG !== 'undefined' && AUDIO_CONFIG.categories) {
                Object.entries(AUDIO_CONFIG.categories).forEach(([key, category]) => {
                    const categoryCard = createCategoryCard(key, category);
                    categoryGrid.appendChild(categoryCard);
                });
            } else {
                // Fallback categories
                const fallbackCategories = [
                    { key: 'meditation', name: 'ÂÜ•ÊÉ≥Èü≥‰πê', icon: 'üßò', desc: 'Ê∑±Â∫¶ÊîæÊùæ', count: 14 },
                    { key: 'nature', name: 'Ëá™ÁÑ∂‰πãÂ£∞', icon: 'üåø', desc: 'È∏üËØ≠Ëä±È¶ô', count: 37 },
                    { key: 'rain', name: 'Èõ®Â£∞Á≥ªÂàó', icon: 'üåßÔ∏è', desc: 'Èõ®ÊâìËä≠Ëïâ', count: 13 },
                    { key: 'singing', name: 'È¢ÇÈíµÁñóÊÑà', icon: 'üïØÔ∏è', desc: 'ÂáÄÂåñËÉΩÈáè', count: 61 }
                ];

                fallbackCategories.forEach(cat => {
                    const categoryCard = createCategoryCard(cat.key, cat);
                    categoryGrid.appendChild(categoryCard);
                });
            }
        }

        function createCategoryCard(key, category) {
            const card = document.createElement('div');
            card.className = 'category-card';
            card.onclick = () => openPlaylist(key, category);

            const count = category.files ? category.files.length : (category.count || 0);

            card.innerHTML = `
                <div class="category-icon">${category.icon || 'üéµ'}</div>
                <div class="category-name">${category.name || key}</div>
                <div class="category-desc">${category.desc || 'ÁñóÊÑàÈü≥‰πê'}</div>
                <div class="category-count">${count} ‰∏™Èü≥È¢ë</div>
            `;

            return card;
        }

        function openPlaylist(categoryKey, category) {
            currentCategory = { key: categoryKey, ...category };

            document.getElementById('playlistTitle').textContent = category.name || categoryKey;
            const trackList = document.getElementById('trackList');
            trackList.innerHTML = '';

            // Load tracks
            if (category.files) {
                tracks = category.files.map((fileName, index) => ({
                    name: fileName.replace(/\.[^/.]+$/, ""), // Remove extension
                    fileName: fileName,
                    url: AUDIO_CONFIG.baseUrl + category.folder + '/' + fileName
                }));
            } else {
                // Fallback tracks
                tracks = [
                    { name: 'Ê∑±Â∫¶ÂÜ•ÊÉ≥', fileName: 'meditation1.mp3', url: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav' },
                    { name: 'ÊîæÊùæÁªÉ‰π†', fileName: 'meditation2.mp3', url: 'https://www.soundjay.com/misc/sounds/bell-ringing-05.wav' }
                ];
            }

            // Display tracks
            tracks.forEach((track, index) => {
                const trackItem = document.createElement('div');
                trackItem.className = 'track-item';
                trackItem.onclick = () => playTrack(index);

                trackItem.innerHTML = `
                    <div class="track-icon">üéµ</div>
                    <div class="track-info">
                        <div class="track-name">${track.name}</div>
                        <div class="track-duration">--:--</div>
                    </div>
                `;

                trackList.appendChild(trackItem);
            });

            // Change background scene
            changeBackgroundScene(categoryKey);

            // Show modal
            document.getElementById('playlistModal').style.display = 'block';
        }

        function closePlaylist() {
            document.getElementById('playlistModal').style.display = 'none';
        }

        function playTrack(index) {
            currentTrackIndex = index;
            const track = tracks[index];

            audio.src = track.url;
            audio.play().then(() => {
                isPlaying = true;
                updatePlayButton();
                showNowPlaying(track);
                showPlayer();
            }).catch(e => {
                console.error('Êí≠ÊîæÂ§±Ë¥•:', e);
                showNotification('Êí≠ÊîæÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï');
            });

            closePlaylist();
        }

        function togglePlayPause() {
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
            } else {
                audio.play();
                isPlaying = true;
            }
            updatePlayButton();
        }

        function stopAudio() {
            audio.pause();
            audio.currentTime = 0;
            isPlaying = false;
            updatePlayButton();
            hidePlayer();
        }

        function previousTrack() {
            if (currentTrackIndex > 0) {
                playTrack(currentTrackIndex - 1);
            } else if (isRepeatMode) {
                playTrack(tracks.length - 1);
            }
        }

        function nextTrack() {
            if (isShuffleMode) {
                const randomIndex = Math.floor(Math.random() * tracks.length);
                playTrack(randomIndex);
            } else if (currentTrackIndex < tracks.length - 1) {
                playTrack(currentTrackIndex + 1);
            } else if (isRepeatMode) {
                playTrack(0);
            }
        }

        function handleTrackEnd() {
            if (isRepeatMode && currentTrackIndex === tracks.length - 1) {
                playTrack(0);
            } else if (currentTrackIndex < tracks.length - 1) {
                nextTrack();
            } else {
                isPlaying = false;
                updatePlayButton();
            }
        }

        function updateProgress() {
            const progress = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
        }

        function updateDuration() {
            document.getElementById('duration').textContent = formatTime(audio.duration);
        }

        function seekTo(event) {
            const progressBar = event.currentTarget;
            const clickX = event.offsetX;
            const width = progressBar.offsetWidth;
            const percentage = clickX / width;
            audio.currentTime = audio.duration * percentage;
        }

        function setVolume(event) {
            const slider = event.currentTarget;
            const clickX = event.offsetX;
            const width = slider.offsetWidth;
            const volume = clickX / width;
            audio.volume = volume;
            document.getElementById('volumeFill').style.width = (volume * 100) + '%';
        }

        function updatePlayButton() {
            const btn = document.getElementById('playPauseBtn');
            btn.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
        }

        function showNowPlaying(track) {
            document.getElementById('currentTrack').textContent = track.name;
            document.getElementById('currentCategory').textContent = currentCategory.name || currentCategory.key;
        }

        function showPlayer() {
            document.getElementById('audioPlayer').classList.add('show');
        }

        function hidePlayer() {
            document.getElementById('audioPlayer').classList.remove('show');
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.style.background = isDarkTheme ? '#1a1a1a' : '#f0f0f0';
            document.body.style.color = isDarkTheme ? 'white' : 'black';
            showNotification(isDarkTheme ? 'Â∑≤ÂàáÊç¢Âà∞Ê∑±Ëâ≤‰∏ªÈ¢ò' : 'Â∑≤ÂàáÊç¢Âà∞ÊµÖËâ≤‰∏ªÈ¢ò');
        }

        function togglePlaylistMode() {
            if (!isShuffleMode && !isRepeatMode) {
                isShuffleMode = true;
                showNotification('ÈöèÊú∫Êí≠ÊîæÂ∑≤ÂºÄÂêØ');
            } else if (isShuffleMode) {
                isShuffleMode = false;
                isRepeatMode = true;
                showNotification('Âæ™ÁéØÊí≠ÊîæÂ∑≤ÂºÄÂêØ');
            } else {
                isRepeatMode = false;
                showNotification('È°∫Â∫èÊí≠ÊîæÊ®°Âºè');
            }
        }

        function openSleepTimer() {
            document.getElementById('timerModal').style.display = 'block';
        }

        function setTimer(minutes) {
            if (sleepTimer) {
                clearTimeout(sleepTimer);
                sleepTimer = null;
            }

            if (minutes > 0) {
                sleepTimer = setTimeout(() => {
                    stopAudio();
                    showNotification('Áù°Áú†ÂÆöÊó∂Âô®Â∑≤ÂÅúÊ≠¢Êí≠Êîæ');
                }, minutes * 60 * 1000);
                showNotification(`Áù°Áú†ÂÆöÊó∂Âô®Â∑≤ËÆæÁΩÆ‰∏∫${minutes}ÂàÜÈíü`);
            }

            document.getElementById('timerModal').style.display = 'none';
        }

        function changeBackgroundScene(category) {
            currentScene = category;
            particles = [];

            // Configure scene based on category
            const sceneConfigs = {
                'Animal sounds': { color: '#4CAF50', particleCount: 50, type: 'leaves' },
                'Chakra': { color: '#9C27B0', particleCount: 30, type: 'energy' },
                'Fire': { color: '#FF5722', particleCount: 40, type: 'sparks' },
                'hypnosis': { color: '#3F51B5', particleCount: 60, type: 'stars' },
                'meditation': { color: '#2196F3', particleCount: 20, type: 'bubbles' },
                'Rain': { color: '#00BCD4', particleCount: 80, type: 'rain' },
                'running water': { color: '#009688', particleCount: 40, type: 'waves' },
                'Singing bowl sound': { color: '#FFC107', particleCount: 25, type: 'rings' },
                'Subconscious Therapy': { color: '#673AB7', particleCount: 35, type: 'cosmic' }
            };

            const config = sceneConfigs[category] || sceneConfigs['default'];
            initParticles(config);
        }

        function initParticles(config) {
            for (let i = 0; i < config.particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 2,
                    vy: (Math.random() - 0.5) * 2,
                    size: Math.random() * 3 + 1,
                    color: config.color,
                    type: config.type,
                    angle: Math.random() * Math.PI * 2
                });
            }
        }

        function animateBackground() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach(particle => {
                // Update position
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.angle += 0.02;

                // Wrap around edges
                if (particle.x < 0) particle.x = canvas.width;
                if (particle.x > canvas.width) particle.x = 0;
                if (particle.y < 0) particle.y = canvas.height;
                if (particle.y > canvas.height) particle.y = 0;

                // Draw particle
                ctx.save();
                ctx.globalAlpha = 0.6;
                ctx.fillStyle = particle.color;

                switch(particle.type) {
                    case 'leaves':
                        drawLeaf(particle);
                        break;
                    case 'energy':
                        drawEnergy(particle);
                        break;
                    case 'sparks':
                        drawSpark(particle);
                        break;
                    default:
                        drawCircle(particle);
                }

                ctx.restore();
            });

            requestAnimationFrame(animateBackground);
        }

        function drawCircle(particle) {
            ctx.beginPath();
            ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawLeaf(particle) {
            ctx.save();
            ctx.translate(particle.x, particle.y);
            ctx.rotate(particle.angle);
            ctx.beginPath();
            ctx.ellipse(0, 0, particle.size * 2, particle.size, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        function drawEnergy(particle) {
            const gradient = ctx.createRadialGradient(particle.x, particle.y, 0, particle.x, particle.y, particle.size * 3);
            gradient.addColorStop(0, particle.color);
            gradient.addColorStop(1, 'transparent');
            ctx.fillStyle = gradient;
            ctx.fillRect(particle.x - particle.size * 3, particle.y - particle.size * 3, particle.size * 6, particle.size * 6);
        }

        function drawSpark(particle) {
            ctx.beginPath();
            ctx.moveTo(particle.x, particle.y - particle.size * 2);
            ctx.lineTo(particle.x - particle.size, particle.y + particle.size);
            ctx.lineTo(particle.x + particle.size, particle.y + particle.size);
            ctx.closePath();
            ctx.fill();
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const playlistModal = document.getElementById('playlistModal');
            const timerModal = document.getElementById('timerModal');

            if (event.target === playlistModal) {
                closePlaylist();
            }

            if (event.target === timerModal) {
                document.getElementById('timerModal').style.display = 'none';
            }
        }

        // Initialize default background
        changeBackgroundScene('default');
    </script>
</body>
</html>