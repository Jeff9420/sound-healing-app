<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://www.google-analytics.com https://www.gstatic.com https://formspree.io https://*.firebaseio.com https://*.googleapis.com https://cdn.amplitude.com https://browser.sentry-cdn.com https://cdn.jsdelivr.net https://vercel.live; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: https: blob:; media-src 'self' https://archive.org https://*.archive.org https://media.soundflows.app blob: data:; connect-src 'self' https://www.google-analytics.com https://formspree.io https://archive.org https://*.archive.org https://media.soundflows.app https://*.firebaseio.com https://*.googleapis.com https://firestore.googleapis.com https://cdn.amplitude.com https://*.sentry.io; frame-src 'none'; object-src 'none'; base-uri 'self'; form-action 'self' https://formspree.io; upgrade-insecure-requests;">
    <meta name="build-version" content="v4.0.0-deep-immersion">
    <base href="/">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.soundflows.app/en/">

    <!-- Alternate Language Versions (hreflang) -->
    <link rel="alternate" hreflang="en" href="https://www.soundflows.app/en/">
    <link rel="alternate" hreflang="zh-Hans" href="https://www.soundflows.app/zh/">
    <link rel="alternate" hreflang="x-default" href="https://www.soundflows.app/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.soundflows.app/en/">
    <meta property="og:title" content="SoundFlows | Deep Immersion Sound Healing">
    <meta property="og:description"
        content="Experience deep relaxation with immersive soundscapes. Rain sounds, white noise, and meditation music designed for sleep and focus.">
    <meta property="og:image" content="https://www.soundflows.app/assets/images/og-image.jpg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Legacy/Functional CSS (Loaded first) -->
    <link rel="stylesheet" href="../assets/css/components/auth-ui.css">
    <link rel="stylesheet" href="../assets/css/history-favorites.css">
    <link rel="stylesheet" href="../assets/css/mixer.css">
    <link rel="stylesheet" href="../assets/css/stats-dashboard.css">
    <link rel="stylesheet" href="../assets/css/accessibility.css">

    <!-- Deep Immersion Theme (Loaded last to override) -->
    <link rel="stylesheet" href="../assets/css/themes/deep-immersion.css">
    <link rel="stylesheet" href="../assets/css/components/glass-card.css">
    <link rel="stylesheet" href="../assets/css/components/floating-player.css">

    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Analytics Configuration -->
    <script src="../assets/js/analytics-config.js"></script>

    <!-- Amplitude Web SDK -->
    <script src="https://cdn.amplitude.com/script/b6c4ebe3ec4d16c8f5fd258d29653cfc.js"></script>
    <script>
        (function initAmplitudeSafely() {
            try {
                var amplitude = window.amplitude;
                if (!amplitude || typeof amplitude.init !== 'function') return;
                amplitude.init('b6c4ebe3ec4d16c8f5fd258d29653cfc', { "fetchRemoteConfig": true, "autocapture": true });
            } catch (error) { console.warn('Amplitude init failed:', error); }
        })();
    </script>
</head>

<body>
    <!-- Background Animation -->
    <div class="ambient-bg"></div>

    <!-- Navbar -->
    <nav style="padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center;">
        <div style="font-weight: 600; font-size: 1.5rem; letter-spacing: 0.05em;">SoundFlows</div>
        <div style="display: flex; gap: 2rem;">
            <a href="/zh/" style="color: var(--text-muted); font-size: 0.9rem;">中文</a>
            <button id="navHistoryBtn" onclick="window.historyFavoritesUI?.openPanel('history')"
                style="background:none; border:none; color:var(--text-muted); cursor:pointer;">History</button>
            <button id="navFavoritesBtn" onclick="window.historyFavoritesUI?.openPanel('favorites')"
                style="background:none; border:none; color:var(--text-muted); cursor:pointer;">Favorites</button>
        </div>
    </nav>

    <!-- Hero Section -->
    <header
        style="height: 60vh; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 0 2rem;">
        <h1
            style="font-size: 4rem; margin-bottom: 1rem; background: linear-gradient(to right, #fff, #94A3B8); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
            Find Your Frequency</h1>
        <p style="font-size: 1.2rem; color: var(--text-muted); max-width: 600px; margin-bottom: 3rem;">Immersive
            soundscapes engineered for deep sleep, focus, and relaxation.</p>
        <button onclick="document.getElementById('sound-grid').scrollIntoView({behavior: 'smooth'})"
            style="padding: 1rem 2.5rem; background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); color: white; border-radius: 50px; font-size: 1.1rem; cursor: pointer; backdrop-filter: blur(10px); transition: all 0.3s;">Start
            Listening</button>
    </header>

    <!-- Sound Grid -->
    <div class="container" id="sound-grid">
        <div class="cards-container">
            <!-- Rain -->
            <div class="glass-card" onclick="playTrack('rain_heavy', 'Heavy Rain', 'Sleep')">
                <span class="icon">🌧️</span>
                <h3>Heavy Rain</h3>
                <p>Continuous heavy rain for deep sleep.</p>
            </div>
            <!-- Ocean -->
            <div class="glass-card" onclick="playTrack('ocean_waves', 'Ocean Waves', 'Relax')">
                <span class="icon">🌊</span>
                <h3>Ocean Waves</h3>
                <p>Rhythmic waves to calm anxiety.</p>
            </div>
            <!-- Forest -->
            <div class="glass-card" onclick="playTrack('forest_birds', 'Forest Bathing', 'Nature')">
                <span class="icon">🌲</span>
                <h3>Forest Bathing</h3>
                <p>Birds and wind in the trees.</p>
            </div>
            <!-- White Noise -->
            <div class="glass-card" onclick="playTrack('white_noise', 'White Noise', 'Focus')">
                <span class="icon">⚡</span>
                <h3>White Noise</h3>
                <p>Pure static to block distractions.</p>
            </div>
            <!-- Alpha Waves -->
            <div class="glass-card" onclick="playTrack('binaural_alpha', 'Alpha Waves', 'Focus')">
                <span class="icon">🧠</span>
                <h3>Alpha Waves</h3>
                <p>10Hz binaural beats for concentration.</p>
            </div>
            <!-- Fireplace -->
            <div class="glass-card" onclick="playTrack('fireplace', 'Fireplace', 'Relax')">
                <span class="icon">🔥</span>
                <h3>Fireplace</h3>
                <p>Crackling fire for a warm ambiance.</p>
            </div>
        </div>
    </div>

    <!-- Floating Player -->
    <div id="audioPlayer" class="floating-player hidden">
        <div class="player-info">
            <span id="playerTrackTitle" class="player-title">Select a Sound</span>
            <span id="playerTrackCategory" class="player-sub">SoundFlows</span>
        </div>
        <div class="player-controls">
            <audio id="mainAudio" loop></audio>
            <button class="p-btn" id="prevBtn" onclick="playRandomTrack()">⏮</button>
            <button class="p-btn play-circle" id="playBtn">▶</button>
            <button class="p-btn" id="nextBtn" onclick="playRandomTrack()">⏭</button>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="0.8"
                style="width: 80px; accent-color: var(--accent-glow);">
        </div>
    </div>

    <!-- Hidden Elements for Logic Compatibility -->
    <div id="loadingScreen" style="display:none;"></div>

    <!-- Scripts -->
    <script src="../assets/js/i18n-system.js"></script>
    <script src="../assets/js/audio-config.js"></script>
    <script src="../assets/js/index-app.js"></script>
    <script src="../assets/js/history-favorites.js"></script>

    <script>
        // Simple inline logic to bridge the new UI with the existing app logic
        const audio = document.getElementById('mainAudio');
        const playBtn = document.getElementById('playBtn');
        const player = document.getElementById('audioPlayer');
        const titleEl = document.getElementById('playerTrackTitle');
        const catEl = document.getElementById('playerTrackCategory');

        // Map of tracks (simplified for this demo, normally comes from audio-config.js)
        const tracks = {
            'rain_heavy': { url: 'https://media.soundflows.app/rain-heavy.mp3', name: 'Heavy Rain', cat: 'Sleep' },
            'ocean_waves': { url: 'https://media.soundflows.app/ocean-waves.mp3', name: 'Ocean Waves', cat: 'Relax' },
            'forest_birds': { url: 'https://media.soundflows.app/forest.mp3', name: 'Forest Bathing', cat: 'Nature' },
            'white_noise': { url: 'https://media.soundflows.app/white-noise.mp3', name: 'White Noise', cat: 'Focus' },
            'binaural_alpha': { url: 'https://media.soundflows.app/binaural-alpha.mp3', name: 'Alpha Waves', cat: 'Focus' },
            'fireplace': { url: 'https://media.soundflows.app/fireplace.mp3', name: 'Fireplace', cat: 'Relax' }
        };

        function playTrack(id, name, cat) {
            const url = tracks[id] ? tracks[id].url : `https://media.soundflows.app/${id}.mp3`;

            audio.src = url;
            audio.play().catch(e => console.log('Playback failed:', e));

            titleEl.textContent = name;
            catEl.textContent = cat;

            player.classList.remove('hidden');
            playBtn.textContent = '⏸';

            // Update active card state
            document.querySelectorAll('.glass-card').forEach(c => c.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        playBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playBtn.textContent = '⏸';
            } else {
                audio.pause();
                playBtn.textContent = '▶';
            }
        });

        document.getElementById('volumeSlider').addEventListener('input', (e) => {
            audio.volume = e.target.value;
        });

        function playRandomTrack() {
            const keys = Object.keys(tracks);
            const randomKey = keys[Math.floor(Math.random() * keys.length)];
            const t = tracks[randomKey];
            playTrack(randomKey, t.name, t.cat);
        }
    </script>
</body>

</html>